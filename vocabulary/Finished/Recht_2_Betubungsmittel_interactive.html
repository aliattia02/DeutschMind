<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Vocabulary - Interactive Audio Learning - Recht 2_Betubungsmittel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(90deg, #000000, #DD0000, #FFCE00);
            color: white;
            text-align: center;
            padding: 40px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .audio-controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .audio-controls h3 {
            color: #667eea;
            margin-bottom: 10px;
            width: 100%;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
        }

        .control-group select,
        .control-group input {
            padding: 8px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .play-all-btn {
            background: linear-gradient(135deg, #DD0000, #FFCE00);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .play-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .tab-button {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: #DD0000;
            color: white;
        }

        .tab-button.active {
            background: #DD0000;
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #DD0000;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #FFCE00;
            padding-bottom: 10px;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .vocab-table th {
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }

        /* COLOR-CODED HEADERS FOR EACH ARTICLE */
        /* der = BLUE, das = GREEN, die = RED */
        .vocab-table.der th {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .vocab-table.das th {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }

        .vocab-table.die th {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }

        .vocab-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .vocab-table tr {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* PERMANENT COLOR-CODED ROW BACKGROUNDS */
        /* der = BLUE, das = GREEN, die = RED */
        .vocab-table.der tbody tr {
            background: #E3F2FD;
        }

        .vocab-table.das tbody tr {
            background: #E8F5E9;
        }

        .vocab-table.die tbody tr {
            background: #FFEBEE;
        }

        /* DARKER ON HOVER */
        .vocab-table.der tbody tr:hover {
            background: #BBDEFB;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .vocab-table.das tbody tr:hover {
            background: #C8E6C9;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .vocab-table.die tbody tr:hover {
            background: #FFCDD2;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        .article {
            font-weight: bold;
            font-size: 1.1em;
        }

        /* COLOR-CODED ARTICLES AND WORDS */
        /* der = BLUE, das = GREEN, die = RED */
        .vocab-table.der .article,
        .vocab-table.der .german-word {
            color: #1565C0;
            font-weight: 700;
        }

        .vocab-table.das .article,
        .vocab-table.das .german-word {
            color: #2E7D32;
            font-weight: 700;
        }

        .vocab-table.die .article,
        .vocab-table.die .german-word {
            color: #C62828;
            font-weight: 700;
        }
        /* MOBILE-RESPONSIVE NOUNS TABLE */
        @media (max-width: 768px) {
            .vocab-table {
                display: none; /* Hide table on mobile */
            }

            .mobile-noun-card {
                display: block;
                background: white;
                border-left: 5px solid;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .mobile-noun-card.der {
                border-color: #2196F3;
                background: #E3F2FD;
            }

            .mobile-noun-card.das {
                border-color: #4CAF50;
                background: #E8F5E9;
            }

            .mobile-noun-card.die {
                border-color: #F44336;
                background: #FFEBEE;
            }

            .mobile-noun-card:active {
                transform: scale(0.98);
            }

            .mobile-noun-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }

            .mobile-article-word {
                font-size: 1.3em;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .mobile-article-word.der {
                color: #1565C0;
            }

            .mobile-article-word.das {
                color: #2E7D32;
            }

            .mobile-article-word.die {
                color: #C62828;
            }

            .mobile-audio-btn {
                background: #FFCE00;
                border: none;
                padding: 8px 12px;
                border-radius: 15px;
                font-size: 1.1em;
                cursor: pointer;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }

            .mobile-audio-btn:active {
                transform: scale(0.95);
            }

            .mobile-noun-details {
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 8px 12px;
                font-size: 0.95em;
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px solid rgba(0,0,0,0.1);
            }

            .mobile-label {
                font-weight: 600;
                color: #666;
            }

            .mobile-plural {
                color: #764ba2;
                font-style: italic;
                font-weight: 600;
            }

            .mobile-english {
                color: #444;
            }

            /* Show mobile cards only on mobile */
            .mobile-noun-cards {
                display: none;
            }

            @media (max-width: 768px) {
                .mobile-noun-cards {
                    display: block;
                }
            }
        }

        /* Desktop: hide mobile cards */
        @media (min-width: 769px) {
            .mobile-noun-cards {
                display: none;
            }
        }
        .german-word {
            font-size: 1.2em;
        }

        .english-word {
            color: #666;
        }

        .plural {
            color: #764ba2;
            font-style: italic;
            font-weight: 600;
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .word-pair {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            cursor: pointer;
        }

        .word-pair:hover {
            transform: scale(1.05);
        }

        .word-pair .german {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .word-pair .english {
            font-size: 1em;
            opacity: 0.9;
        }

        .opposite-arrow {
            font-size: 1.5em;
            margin: 10px 0;
        }

        .word-pair .card-audio-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .word-pair .card-audio-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .expression-list {
            list-style: none;
            padding: 0;
        }

        .expression-item {
            background: #f8f9fa;
            margin: 10px 0;
            padding: 20px;
            border-left: 5px solid #DD0000;
            border-radius: 5px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .expression-item:hover {
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: #fff;
        }

        .expression-german {
            font-size: 1.4em;
            font-weight: bold;
            color: #000;
            margin-bottom: 5px;
        }

        .expression-english {
            font-size: 1.1em;
            color: #666;
        }

        .conversation {
            margin: 20px 0;
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 80%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .message:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: translateX(5px);
        }

        .message-a {
            background: #667eea;
            color: white;
            margin-left: 0;
            border-bottom-left-radius: 5px;
        }

        .message-b {
            background: #f093fb;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message-german {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .message-english {
            font-size: 0.95em;
            opacity: 0.9;
            font-style: italic;
        }

        .qa-container {
            display: grid;
            gap: 20px;
        }

        .qa-card {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .qa-card:hover {
            border-color: #DD0000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .question {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .answer {
            font-size: 1.1em;
            color: #333;
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .qa-card:hover .answer {
            display: block;
        }

        .sentence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sentence-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sentence-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .sentence-german {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .sentence-english {
            font-size: 1em;
            opacity: 0.9;
        }

        .audio-btn {
            background: #FFCE00;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .audio-btn:hover {
            background: #DD0000;
            color: white;
            transform: scale(1.1);
        }

        .audio-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .audio-status.show {
            display: flex;
        }

        .audio-status .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
        }

        footer p {
            margin: 10px 0;
        }

        .section-icon {
            font-size: 2em;
            margin-right: 10px;
            vertical-align: middle;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            .tabs {
                flex-direction: column;
            }
            .tab-button {
                width: 100%;
            }
            .word-grid {
                grid-template-columns: 1fr;
            }
            .sentence-grid {
                grid-template-columns: 1fr;
            }
            .message {
                max-width: 90%;
            }
            .audio-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<!-- NAVIGATION -->
<div style="background: #000; padding: 15px; text-align: center;">
    <a href="../index.html" style="color: #FFCE00; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üè† Home</a>
    <a href="../index.html#levels" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üìö Levels</a>
    <a href="../index.html#categories" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üéØ Categories</a>
    <a href="../tools/progress.html" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üìä Progress</a>
    <a href="../about.html" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">‚ÑπÔ∏è About</a>
</div>

    <!-- ============================================ -->
    <!-- EDIT SECTION 1: HEADER INFORMATION -->
    <!-- ============================================ -->
    <header>
        <h1>üá©üá™ Recht 2_Betubungsmittel</h1>
        <p id="headerTopic">Recht 2_Betubungsmittel | Interactive Audio Learning</p>
        <p style="font-size: 0.9em; margin-top: 10px;"Created by: aliattia02 | Date: 2025-11-16</p>
    </header>

    <div class="container">
        <div class="audio-controls">
            <h3>üîä Audio Settings</h3>
            <div class="control-group">
                <label for="voiceSelect">Voice:</label>
                <select id="voiceSelect">
                    <option value="">Loading voices...</option>
                </select>
            </div>
            <div class="control-group">
                <label for="speedControl">Speed:</label>
                <input type="range" id="speedControl" min="0.5" max="1.5" step="0.1" value="0.8">
                <span id="speedValue">0.8x</span>
            </div>
            <div class="control-group">
                <label for="pitchControl">Pitch:</label>
                <input type="range" id="pitchControl" min="0.5" max="2" step="0.1" value="1">
                <span id="pitchValue">1.0</span>
            </div>
            <button class="play-all-btn" onclick="playAllInSection()">‚ñ∂ Play All in Section</button>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('nouns')">üìö Nouns</button>
            <button class="tab-button" onclick="showTab('adjectives')">‚ú® Adjectives</button>
            <button class="tab-button" onclick="showTab('verbs')">‚ö° Verbs</button>
            <button class="tab-button" onclick="showTab('expressions')">üí¨ Key Expressions</button>
            <button class="tab-button" onclick="showTab('conversations')">üó£Ô∏è Conversations</button>
            <button class="tab-button" onclick="showTab('qa')">‚ùì Q&A Practice</button>
            <button class="tab-button" onclick="showTab('sentences')">üìù Quick Sentences</button>
        </div>

        <div id="nouns" class="tab-content active">
            <div class="card">
                <h2><span class="section-icon">üìö</span>Nouns - Die Nomen</h2>
                <div id="nounsContainer"></div>
            </div>
        </div>

        <div id="adjectives" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">‚ú®</span>Adjectives - Die Adjektive</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any card to hear the pronunciation!</p>
                <div id="adjectivesContainer" class="word-grid"></div>
            </div>
        </div>

        <div id="verbs" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">‚ö°</span>Verbs - Die Verben</h2>
                <p style="margin-bottom: 20px;"><strong>*</strong> = Weak Verb | <strong>+</strong> = Strong Verb</p>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any card to hear the pronunciation!</p>
                <div id="verbsContainer" class="word-grid"></div>
            </div>
        </div>

        <div id="expressions" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">üí¨</span>Key Expressions - Wichtige Ausdr√ºcke</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any expression to hear the pronunciation!</p>
                <ul id="expressionsContainer" class="expression-list"></ul>
            </div>
        </div>

        <div id="conversations" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">üó£Ô∏è</span>Mini Conversations - Kurze Gespr√§che</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any message to hear it!</p>
                <div id="conversationsContainer"></div>
            </div>
        </div>

        <div id="qa" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">‚ùì</span>Q&A Practice - Fragen und Antworten</h2>
                <p style="margin-bottom: 20px; font-style: italic; color: #666;">üí° Hover over each card to see the answer, or click to hear it!</p>
                <div id="qaContainer" class="qa-container"></div>
            </div>
        </div>

        <div id="sentences" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">üìù</span>Quick Sentences - Schnelle S√§tze</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any sentence to hear it!</p>
                <div id="sentencesContainer" class="sentence-grid"></div>
            </div>
        </div>
    </div>

    <div class="audio-status" id="audioStatus">
        <div class="spinner"></div>
        <span id="audioStatusText">Speaking...</span>
    </div>

    <footer>
        <p><strong>German Vocabulary - Interactive Audio Learning</strong></p>
        <p>Created for German Learners | ¬© 2025 aliattia02</p>
        <p>üîß Interactive Audio Learning Platform</p>
        <p style="margin-top: 20px; font-size: 0.9em;">
            üéØ Click anywhere to hear pronunciation | üí™ Practice makes perfect!
        </p>
        <p style="margin-top: 10px; font-size: 0.8em; opacity: 0.8;">
            Last Updated: 2025-11-16
        </p>
    </footer>

    <script>

// ============================================
// TOPIC: ARZNEIMITTELRECHT (Pharmaceutical Law)
// ============================================

// ============================================
// EDIT SECTION 2: CSV DATA - NOUNS
// ============================================
const nounsCSV = `
das,Bet√§ubungsmittel,=,die Bet√§ubungsmittel,Narcotic
das,Bet√§ubungsmittelgesetz,---,die Bet√§ubungsmittelgesetz,Narcotics Act
das,Suchtstoff√ºbereinkommen,=,die Suchtstoff√ºbereinkommen,Convention on Narcotic Drugs
das,Opiumabkommen,=,die Opiumabkommen,Opium Convention
das,Analgetikum,Analgetika,die Analgetika,Analgesic
das,Opioid,-e,die Opioide,Opioid
das,Morphin,---,das Morphin,Morphine
das,Heroin,---,das Heroin,Heroin
das,Diamorphin,---,das Diamorphin,Diamorphine
das,Methadon,---,das Methadon,Methadone
das,Levomethadon,---,das Levomethadon,Levomethadone
das,Buprenorphin,---,das Buprenorphin,Buprenorphine
das,Fentanyl,---,das Fentanyl,Fentanyl
das,Codein,---,das Codein,Codeine
das,Dihydrocodein,---,das Dihydrocodein,Dihydrocodeine
das,Tilidin,---,das Tilidin,Tilidine
das,Cocain,---,das Cocain,Cocaine
das,Benzodiazepin,-e,die Benzodiazepine,Benzodiazepine
das,Amphetamin,-e,die Amphetamine,Amphetamine
das,Methylphenidat,-e,die Methylphenidate,Methylphenidate
das,Substitutionsmittel,=,die Substitutionsmittel,Substitution medication
das,Therapiekonzept,-e,die Therapiekonzepte,Therapy concept
das,Bet√§ubungsmittelrezept,-e,die Bet√§ubungsmittelrezepte,Narcotic prescription
das,Formblatt,Formbl√§tter,die Formbl√§tter,Form
das,Rezept,-e,die Rezepte,Prescription
das,Verkehrsverbot,-e,die Verkehrsverbote,Traffic prohibition
das,Risiko,Risiken,die Risiken,Risk
das,Abh√§ngigkeitspotential,-e,die Abh√§ngigkeitspotentiale,Addiction potential
das,Missbrauchspotential,-e,die Missbrauchspotentiale,Abuse potential
der,Verkehr,-e,die Verkehre,Traffic
der,Anbau,Anbauten,die Anbauten,Cultivation
der,Handel,---,der Handel,Trade
der,Erwerb,-e,die Erwerbe,Acquisition
der,Vertrieb,-e,die Vertriebe,Distribution
der,Beikonsum,-e,die Beikonsume,Concurrent use
der,Missbrauch,Missbr√§uche,die Missbr√§uche,Abuse
der,Praxisbedarf,-e,die Praxisbedarfe,Practice supply
der,Stationsbedarf,-e,die Stationsbedarfe,Ward supply
der,Rettungsdienst,-e,die Rettungsdienste,Emergency service
der,Vorrat,Vorr√§te,die Vorr√§te,Stock
der,Erlaubnisvorbehalt,-e,die Erlaubnisvorbehalte,License requirement
der,Nachweis,-e,die Nachweise,Proof
der,Patient,-en,die Patienten,Patient
der,Arzt,√Ñrzte,die √Ñrzte,Doctor
der,Zahnarzt,Zahn√§rzte,die Zahn√§rzte,Dentist
der,Tierarzt,Tier√§rzte,die Tier√§rzte,Veterinarian
der,Apotheker,=,die Apotheker,Pharmacist
der,Tr√§ger,=,die Tr√§ger,Operator
der,Sponsor,-en,die Sponsoren,Sponsor
der,Tierhalter,=,die Tierhalter,Animal owner
der,Zeuge,-n,die Zeugen,Witness
der,Bundesrat,Bundesr√§te,die Bundesr√§te,Federal Council
der,Sachverst√§ndige,-n,die Sachverst√§ndigen,Expert
der,Eigent√ºmer,=,die Eigent√ºmer,Owner
die,Anlage,-n,die Anlagen,Schedule
die,Verschreibung,-en,die Verschreibungen,Prescription
die,Verschreibungspflicht,-en,die Verschreibungspflichten,Prescription requirement
die,Verschreibungsf√§higkeit,-en,die Verschreibungsf√§higkeiten,Prescribability
die,Verkehrsf√§higkeit,-en,die Verkehrsf√§higkeiten,Marketability
die,Erlaubnis,-se,die Erlaubnisse,License
die,Erlaubnispflicht,-en,die Erlaubnispflichten,License requirement
die,Einfuhrgenehmigung,-en,die Einfuhrgenehmigungen,Import permit
die,Ausfuhrgenehmigung,-en,die Ausfuhrgenehmigungen,Export permit
die,Genehmigung,-en,die Genehmigungen,Authorization
die,Abgabe,-n,die Abgaben,Dispensing
die,Einfuhr,-en,die Einfuhren,Import
die,Ausfuhr,-en,die Ausfuhren,Export
die,Durchfuhr,-en,die Durchfuhren,Transit
die,Herstellung,-en,die Herstellungen,Manufacturing
die,Zubereitung,-en,die Zubereitungen,Preparation
die,Menge,-n,die Mengen,Quantity
die,H√∂chstmenge,-n,die H√∂chstmengen,Maximum quantity
die,H√∂chstverschreibungsmenge,-en,die H√∂chstverschreibungsmengen,Maximum prescription quantity
die,Packungseinheit,-en,die Packungseinheiten,Package unit
die,Darreichungsform,-en,die Darreichungsformen,Dosage form
die,Dosierung,-en,die Dosierungen,Dosage
die,Einzelgabe,-n,die Einzelgaben,Single dose
die,Tagesgabe,-n,die Tagesgaben,Daily dose
die,Gebrauchsanweisung,-en,die Gebrauchsanweisungen,Instructions for use
die,Substitution,-en,die Substitutionen,Substitution
die,Substitutionsbehandlung,-en,die Substitutionsbehandlungen,Substitution treatment
die,Opioidabh√§ngigkeit,-en,die Opioidabh√§ngigkeiten,Opioid dependency
die,Abstinenz,-en,die Abstinenzen,Abstinence
die,Stabilisierung,-en,die Stabilisierungen,Stabilization
die,Einstellung,-en,die Einstellungen,Adjustment
die,Einnahme,-n,die Einnahmen,Intake
die,Anwendung,-en,die Anwendungen,Application
die,Verabreichung,-en,die Verabreichungen,Administration
die,Aush√§ndigung,-en,die Aush√§ndigungen,Handing over
die,Lagerung,-en,die Lagerungen,Storage
die,Aufbewahrung,-en,die Aufbewahrungen,Keeping
die,Sicherung,-en,die Sicherungen,Security
die,Entnahme,-n,die Entnahmen,Removal
die,Vernichtung,-en,die Vernichtungen,Destruction
die,Wiedergewinnung,-en,die Wiedergewinnungen,Recovery
die,Dokumentation,-en,die Dokumentationen,Documentation
die,√úberwachung,-en,die √úberwachungen,Supervision
die,Kontrolle,-n,die Kontrollen,Control
die,√úberpr√ºfung,-en,die √úberpr√ºfungen,Review
die,Pr√ºfung,-en,die Pr√ºfungen,Examination
die,Kartei,-en,die Karteien,Card index
die,Karteikarte,-n,die Karteikarten,Index card
die,Richtlinie,-n,die Richtlinien,Guideline
die,Verordnung,-en,die Verordnungen,Regulation
die,Rechtsverordnung,-en,die Rechtsverordnungen,Legal ordinance
die,Bekanntmachung,-en,die Bekanntmachungen,Announcement
die,Straftat,-en,die Straftaten,Criminal offense
die,Ordnungswidrigkeit,-en,die Ordnungswidrigkeiten,Regulatory offense
die,Rauschgiftkriminalit√§t,-en,die Rauschgiftkriminalit√§ten,Drug crime
die,Gef√§hrdung,-en,die Gef√§hrdungen,Endangerment
die,Gesundheitsgef√§hrdung,-en,die Gesundheitsgef√§hrdungen,Health hazard
die,Bestrafung,-en,die Bestrafungen,Punishment
die,Zustimmung,-en,die Zustimmungen,Consent
die,Anh√∂rung,-en,die Anh√∂rungen,Hearing
die,Apotheke,-n,die Apotheken,Pharmacy
die,Krankenhausapotheke,-n,die Krankenhausapotheken,Hospital pharmacy
die,Hausapotheke,-n,die Hausapotheken,Home dispensary
die,Beh√∂rde,-n,die Beh√∂rden,Authority
die,Bundesoberbeh√∂rde,-n,die Bundesoberbeh√∂rden,Federal supreme authority
die,Bundesopiumstelle,-n,die Bundesopiumstellen,Federal Opium Agency
die,Kreisverwaltungsbeh√∂rde,-n,die Kreisverwaltungsbeh√∂rden,District authority
die,Gesundheitsabteilung,-en,die Gesundheitsabteilungen,Health department
die,Einrichtung,-en,die Einrichtungen,Facility
die,Teileinheit,-en,die Teileinheiten,Sub-unit
die,Station,-en,die Stationen,Ward
die,Heimversorgung,-en,die Heimversorgungen,Nursing home care
die,Bescheinigung,-en,die Bescheinigungen,Certificate
die,Unterschrift,-en,die Unterschriften,Signature
die,Telephonnummer,-n,die Telephonnummern,Telephone number
die,Berufsbezeichnung,-en,die Berufsbezeichnungen,Professional title
die,Pharmazentralnummer,-n,die Pharmazentralnummern,Pharmaceutical central number
die,BtM-Nummer,-n,die BtM-Nummern,Narcotic registration number
die,Abgabemeldung,-en,die Abgabemeldungen,Supply notification
die,Empfangsbest√§tigung,-en,die Empfangsbest√§tigungen,Acknowledgment of receipt
die,Lieferschein,-e,die Lieferscheine,Delivery note
die,Sendebeleg,-e,die Sendebelege,Dispatch receipt
die,Abweichung,-en,die Abweichungen,Deviation
die,√úbereinstimmung,-en,die √úbereinstimmungen,Accordance
die,Zwischenstufe,-n,die Zwischenstufen,Intermediate stage
die,Derivat,-e,die Derivate,Derivative
die,Lokalan√§sthesie,Lokalan√§sthesien,die Lokalan√§sthesien,Local anesthesia
die,L√∂sung,-en,die L√∂sungen,Solution
die,Salbe,-n,die Salben,Ointment
die,Ampulle,-n,die Ampullen,Ampoule
die,Tablette,-n,die Tabletten,Tablet
die,Augentropfen,nur P,die Augentropfen,Eye drops
die,Retardtablette,-n,die Retardtabletten,Extended-release tablet


`.trim();

// ============================================
// EDIT SECTION 3: CSV DATA - ADJECTIVES
// ============================================
const adjectivesCSV = `
german,english,opposite_german,opposite_english
verkehrsf√§hig,marketable,nicht verkehrsf√§hig,not marketable
verschreibungsf√§hig,prescribable,nicht verschreibungsf√§hig,not prescribable
verschreibungspflichtig,prescription-only,freiverk√§uflich,over-the-counter
erlaubnispflichtig,requiring license,erlaubnisfrei,license-free
zugelassen,approved/authorized,nicht zugelassen,not approved
erlaubt,permitted,verboten,prohibited
zul√§ssig,permissible,unzul√§ssig,inadmissible
legal,legal,illegal,illegal
befugt,authorized,unbefugt,unauthorized
g√ºltig,valid,ung√ºltig,invalid
begr√ºndet,justified,unbegr√ºndet,unjustified
notwendig,necessary,unn√∂tig,unnecessary
erforderlich,required,nicht erforderlich,not required
wissenschaftlich,scientific,unwissenschaftlich,unscientific
therapeutisch,therapeutic,nicht therapeutisch,non-therapeutic
medizinisch,medical,nicht-medizinisch,non-medical
menschlich,human,tierisch,animal
geeignet,suitable,ungeeignet,unsuitable
stabilisiert,stabilized,instabil,unstable
abgeschlossen,completed,nicht abgeschlossen,incomplete
unmittelbar,immediate,mittelbar,indirect
eigenverantwortlich,self-responsible,fremdverantwortlich,externally supervised
eigenh√§ndig,by one's own hand,nicht eigenh√§ndig,not personally signed
√ºbereinstimmend,consistent,abweichend,deviating
vollst√§ndig,complete,unvollst√§ndig,incomplete
schriftlich,written,m√ºndlich,oral
halbj√§hrlich,semi-annual,monatlich,monthly
vierteilig,four-part,dreiteilig,three-part
elektronisch,electronic,analog,analog
parenteral,parenteral,oral,oral
stark,strong,schwach,weak
rein,pure,unrein,impure
abgeteilt,divided/portioned,nicht abgeteilt,undivided
gesondert,separate,gemeinsam,together



`.trim();

// ============================================
// EDIT SECTION 4: CSV DATA - VERBS
// ============================================
const verbsCSV = `
type,german1,english1,german2,english2
weak,verschreiben,prescribe,abgeben,dispense
weak,verordnen,order/prescribe,beliefern,supply
weak,anbauen,cultivate,herstellen,manufacture
weak,handeln,trade,vertreiben,distribute
weak,erwerben,acquire,ver√§u√üern,sell
weak,einf√ºhlen,import,ausf√ºhren,export
weak,beantragen,apply for,genehmigen,approve
weak,erlauben,permit,verbieten,prohibit
weak,zulassen,authorize,ausschlie√üen,exclude
weak,dokumentieren,document,nachweisen,prove
weak,lagern,store,aufbewahren,keep/store
weak,sichern,secure,entnehmen,remove
weak,vernichten,destroy,wiederzugewinnen,recover
weak,dosieren,dose,verabreichen,administer
weak,einnehmen,take/ingest,aush√§ndigen,hand over
weak,anwenden,apply/use,missbrauchen,abuse
weak,substituieren,substitute,entziehen,withdraw
weak,stabilisieren,stabilize,gef√§hrden,endanger
weak,einstellen,adjust,absetzen,discontinue
weak,√ºberwachen,supervise,kontrollieren,control
weak,pr√ºfen,check/examine,√ºberpr√ºfen,verify
weak,beauftragen,commission,entlasten,relieve
weak,kennzeichnen,mark,unterschreiben,sign
weak,verwalten,manage,durchf√ºhren,carry out
weak,behandeln,treat,heilen,heal
weak,verzichten,renounce,konsumieren,consume
weak,melden,report,best√§tigen,confirm
weak,zur√ºckgeben,return,weiterleiten,forward
weak,absenden,send off,empfangen,receive
strong,unterliegen,be subject to,entfallen,be omitted
strong,gelten,be valid/apply,versto√üen,violate
strong,bestehen,exist/consist,enthalten,contain
strong,vorschreiben,prescribe/stipulate,ausschlie√üen,exclude
strong,ausgeben,issue,erhalten,receive
strong,bringen,bring,nehmen,take
strong,schreiben,write,lesen,read
strong,tragen,carry,geben,give



`.trim();

// ============================================
// EDIT SECTION 5: CSV DATA - EXPRESSIONS
// ============================================
const expressionsCSV = `
german,english
Haben Sie ein Bet√§ubungsmittelrezept?,Do you have a narcotic prescription?
Das unterliegt der Verschreibungspflicht.,That requires a prescription.
Das ist nicht verkehrsf√§hig.,That is not marketable.
Das ist verkehrsf√§hig aber nicht verschreibungsf√§hig.,That is marketable but not prescribable.
Eine Erlaubnis ist erforderlich.,A license is required.
Das ist erlaubnispflichtig.,That requires a license.
Ohne Erlaubnis verboten.,Prohibited without license.
Generelles Verkehrsverbot mit Erlaubnisvorbehalt.,General traffic prohibition subject to license.
Das ist nur f√ºr wissenschaftliche Zwecke erlaubt.,That is permitted only for scientific purposes.
Die Verschreibung muss begr√ºndet sein.,The prescription must be justified.
Praxisbedarf: durchschnittlicher Zweiwochenbedarf.,Practice supply: average two-week requirement.
Aush√§ndigung zur eigenverantwortlichen Einnahme.,Delivery for self-responsible intake.
Kennzeichnung mit S und T erforderlich.,Marking with S and T required.
Gesondert aufbewahren und sichern.,Store separately and secure.
In Gegenwart von zwei Zeugen vernichten.,Destroy in the presence of two witnesses.
Keine H√∂chstverschreibungsmengen mehr.,No more maximum prescription quantities.
Das ist eine Ordnungswidrigkeit.,That is a regulatory offense.
Das verst√∂√üt gegen das BtMG.,That violates the Narcotics Act.
Behandlung vor Strafe.,Treatment before punishment.
Substitution zur Behandlung der Opioidabh√§ngigkeit.,Substitution for treatment of opioid dependency.
Der Zustand muss stabilisiert sein.,The condition must be stabilized.
Keine Erkenntnisse √ºber Beikonsum.,No evidence of concurrent use.
Die Einstellung muss abgeschlossen sein.,The adjustment must be completed.
Zur parenteralen Anwendung ungeeignet.,Unsuitable for parenteral application.
Unmittelbare Einnahme unter Aufsicht.,Immediate intake under supervision.
Take-Home-Verschreibung maximal 30 Tage.,Take-home prescription maximum 30 days.
Sp√§testens am n√§chstfolgenden Werktag.,At the latest on the next working day.
Alle Angaben m√ºssen √ºbereinstimmen.,All information must be consistent.
Pr√ºfen Sie die Vollst√§ndigkeit vor der Abgabe.,Check completeness before dispensing.
Eigenh√§ndige Unterschrift erforderlich.,Personal signature required.
Im Vertretungsfall Vermerk i.V.,In case of representation note i.V.
Gebrauchsanweisung mit Einzel- und Tagesgabe.,Instructions with single and daily dose.
Gem√§√ü schriftlicher Anweisung.,According to written instruction.
Das Rezept ist ung√ºltig.,The prescription is invalid.
Die Abgabemeldung elektronisch absenden.,Send the supply notification electronically.
Empfangsbest√§tigung am Werktag zur√ºcksenden.,Return acknowledgment of receipt on working day.
Festgestellte Abweichungen vermerken.,Note detected deviations.
Drei Jahre aufbewahren.,Keep for three years.
Anlage I: nicht verkehrsf√§hig.,Schedule I: not marketable.
Anlage II: verkehrsf√§hig aber nicht verschreibungsf√§hig.,Schedule II: marketable but not prescribable.
Anlage III: verkehrsf√§hig und verschreibungsf√§hig.,Schedule III: marketable and prescribable.



`.trim();

// ============================================
// EDIT SECTION 6: CSV DATA - CONVERSATIONS
// ============================================
const conversationsCSV = `
scenario|speaker,german,english
BtM-Rezept in der Apotheke|A,Guten Tag! Ich brauche ein Schmerzmittel.,Good day! I need a painkiller.
BtM-Rezept in der Apotheke|B,Haben Sie ein Bet√§ubungsmittelrezept?,Do you have a narcotic prescription?
BtM-Rezept in der Apotheke|A,Ja hier ist das Rezept.,Yes here is the prescription.
BtM-Rezept in der Apotheke|B,Moment ich pr√ºfe die Angaben.,One moment I'll check the information.
BtM-Rezept in der Apotheke|A,Ist alles in Ordnung?,Is everything okay?
BtM-Rezept in der Apotheke|B,Ja alle Angaben stimmen √ºberein.,Yes all information is consistent.
BtM-Rezept in der Apotheke|A,Wann kann ich es abholen?,When can I pick it up?
BtM-Rezept in der Apotheke|B,In 30 Minuten ist es fertig.,It will be ready in 30 minutes.
Rezeptpr√ºfung|A,Fehlt etwas auf dem Rezept?,Is anything missing from the prescription?
Rezeptpr√ºfung|B,Die eigenh√§ndige Unterschrift fehlt.,The personal signature is missing.
Rezeptpr√ºfung|A,Ist das Rezept dann ung√ºltig?,Is the prescription invalid then?
Rezeptpr√ºfung|B,Ja Sie m√ºssen zum Arzt zur√ºck.,Yes you must return to the doctor.
Rezeptpr√ºfung|A,Kann der Arzt das telefonisch best√§tigen?,Can the doctor confirm that by phone?
Rezeptpr√ºfung|B,Nein die Unterschrift muss eigenh√§ndig sein.,No the signature must be personal.
Rezeptpr√ºfung|A,Verstehe. Ich gehe nochmal hin.,I understand. I'll go there again.
Rezeptpr√ºfung|B,Gute Entscheidung!,Good decision!
Substitutionsbehandlung|A,Ich hole mein Substitutionsmittel ab.,I'm picking up my substitution medication.
Substitutionsbehandlung|B,Ist es eine Take-Home-Verschreibung?,Is it a take-home prescription?
Substitutionsbehandlung|A,Ja f√ºr sieben Tage.,Yes for seven days.
Substitutionsbehandlung|B,Ihr Zustand ist stabilisiert?,Your condition is stabilized?
Substitutionsbehandlung|A,Ja die Einstellung ist abgeschlossen.,Yes the adjustment is completed.
Substitutionsbehandlung|B,Gut. Das Rezept ist mit S und T gekennzeichnet.,Good. The prescription is marked with S and T.
Substitutionsbehandlung|A,Was bedeutet das?,What does that mean?
Substitutionsbehandlung|B,S f√ºr Substitution T f√ºr Take-Home.,S for substitution T for take-home.
Erlaubnispflicht|A,Brauche ich eine Erlaubnis f√ºr BtM?,Do I need a license for narcotics?
Erlaubnispflicht|B,Apotheken sind nach Paragraph 4 ausgenommen.,Pharmacies are exempt under Section 4.
Erlaubnispflicht|A,Gilt das f√ºr alle Bet√§ubungsmittel?,Does that apply to all narcotics?
Erlaubnispflicht|B,F√ºr Anlage II und III ja.,For Schedule II and III yes.
Erlaubnispflicht|A,Und f√ºr Anlage I?,And for Schedule I?
Erlaubnispflicht|B,Nur f√ºr wissenschaftliche Zwecke mit Erlaubnis.,Only for scientific purposes with license.
Erlaubnispflicht|A,Also generelles Verkehrsverbot?,So general traffic prohibition?
Erlaubnispflicht|B,Ja mit Erlaubnisvorbehalt.,Yes subject to license requirement.
Lagerung und Sicherung|A,Wie m√ºssen wir BtM lagern?,How must we store narcotics?
Lagerung und Sicherung|B,Gesondert aufbewahren und sichern.,Store separately and secure.
Lagerung und Sicherung|A,Gibt es dazu Richtlinien?,Are there guidelines for this?
Lagerung und Sicherung|B,Ja die Richtlinien nach Paragraph 15.,Yes the guidelines under Section 15.
Lagerung und Sicherung|A,Gegen unbefugte Entnahme?,Against unauthorized removal?
Lagerung und Sicherung|B,Genau. Das ist sehr wichtig.,Exactly. That is very important.
Vernichtung|A,Wie vernichten wir nicht ben√∂tigte BtM?,How do we destroy unneeded narcotics?
Vernichtung|B,In Gegenwart von zwei Zeugen.,In the presence of two witnesses.
Vernichtung|A,Ist eine Anzeige erforderlich?,Is notification required?
Vernichtung|B,Nein weder anzeige- noch erlaubnispflichtig.,No neither notification nor license required.
Vernichtung|A,Wiedergewinnung muss ausgeschlossen sein?,Recovery must be excluded?
Vernichtung|B,Ja auch nur teilweise Wiedergewinnung.,Yes even partial recovery.



`.trim();

// ============================================
// EDIT SECTION 7: CSV DATA - Q&A
// ============================================
const qaCSV = `
Ist das BtM-Rezept g√ºltig?,Ja wenn alle Angaben stimmen. (Yes if all information is correct.)
Brauche ich eine Erlaubnis?,Ja f√ºr Anlage I Stoffe. (Yes for Schedule I substances.)
Darf ich Substitutionsmittel abgeben?,Nur mit S-gekennzeichnetem Rezept. (Only with S-marked prescription.)
Ist Methadon verschreibungsf√§hig?,Ja in Anlage III. (Yes in Schedule III.)
Was bedeutet Take-Home?,Mitgabe zur eigenverantwortlichen Einnahme. (Take-home for self-responsible intake.)
Wie lange ist ein BtM-Rezept g√ºltig?,Sieben Tage ab Ausstellung. (Seven days from issue.)
Muss ich BtM gesondert lagern?,Ja gegen unbefugte Entnahme sichern. (Yes secure against unauthorized removal.)
Wie vernichte ich BtM?,In Gegenwart von zwei Zeugen. (In presence of two witnesses.)
Was ist Beikonsum?,Gleichzeitiger Konsum anderer Substanzen. (Concurrent use of other substances.)
Gibt es noch H√∂chstverschreibungsmengen?,Nein seit 2024 nicht mehr. (No not since 2024.)



`.trim();

// ============================================
// EDIT SECTION 8: CSV DATA - SENTENCES
// ============================================
const sentencesCSV = `
Das Bet√§ubungsmittel unterliegt strengen Vorschriften.,The narcotic is subject to strict regulations.
Die Verschreibung muss begr√ºndet sein.,The prescription must be justified.
Das BtM-Rezept ist sieben Tage g√ºltig.,The narcotic prescription is valid for seven days.
Substitution dient der Behandlung der Opioidabh√§ngigkeit.,Substitution serves to treat opioid dependency.
Der Zustand muss stabilisiert sein.,The condition must be stabilized.
Take-Home ist maximal 30 Tage m√∂glich.,Take-home is possible for maximum 30 days.
Die Abgabemeldung erfolgt elektronisch.,The supply notification is done electronically.
Bet√§ubungsmittel m√ºssen gesondert gelagert werden.,Narcotics must be stored separately.
Die Vernichtung erfordert zwei Zeugen.,Destruction requires two witnesses.
Anlage I ist nicht verkehrsf√§hig.,Schedule I is not marketable.
Anlage II ist verkehrsf√§hig aber nicht verschreibungsf√§hig.,Schedule II is marketable but not prescribable.
Anlage III ist verkehrsf√§hig und verschreibungsf√§hig.,Schedule III is marketable and prescribable.
Das Rezept muss eigenh√§ndig unterschrieben sein.,The prescription must be personally signed.
Praxisbedarf ist auf zwei Wochen begrenzt.,Practice supply is limited to two weeks.
Die Dokumentation ist drei Jahre aufzubewahren.,Documentation must be kept for three years.
Ohne Erlaubnis ist der Verkehr verboten.,Without license the traffic is prohibited.
Das verst√∂√üt gegen das BtMG.,That violates the Narcotics Act.
Die Einstellung muss abgeschlossen sein.,The adjustment must be completed.
Zur parenteralen Anwendung ungeeignet.,Unsuitable for parenteral application.
Unmittelbare Einnahme unter Aufsicht erforderlich.,Immediate intake under supervision required.
Alle Angaben m√ºssen √ºbereinstimmen.,All information must be consistent.
Die BtM-Nummer ist erforderlich.,The narcotic registration number is required.



`.trim();

        // ============================================
        // SPEECH SYNTHESIS - FIXED FOR PLURAL ISSUE
        // ============================================
        let germanVoice = null;
        let currentUtterance = null;
        let isSpeaking = false;
        let isPlayingSequence = false; // NEW: Track if playing a sequence

        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';

            const germanVoices = voices.filter(voice => voice.lang.startsWith('de'));

            if (germanVoices.length === 0) {
                voiceSelect.innerHTML = '<option value="">No German voice found - Using default</option>';
                germanVoice = voices.find(v => v.lang.includes('en')) || voices[0];
            } else {
                germanVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    voiceSelect.appendChild(option);
                    if (index === 0) germanVoice = voice;
                });
            }
            console.log('‚úÖ Voice loaded:', germanVoice ? germanVoice.name : 'None');
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        loadVoices();
        setTimeout(loadVoices, 100);
        setTimeout(loadVoices, 500);

        document.getElementById('voiceSelect').addEventListener('change', function(e) {
            stopAllSpeech();
            const voices = window.speechSynthesis.getVoices();
            const germanVoices = voices.filter(voice => voice.lang.startsWith('de'));
            germanVoice = germanVoices[e.target.value] || voices[0];
            console.log('üîÑ Voice changed to:', germanVoice ? germanVoice.name : 'default');
        });

        document.getElementById('speedControl').addEventListener('input', function(e) {
            document.getElementById('speedValue').textContent = e.target.value + 'x';
        });

        document.getElementById('pitchControl').addEventListener('input', function(e) {
            document.getElementById('pitchValue').textContent = e.target.value;
        });

        // IMPROVED: Simple speak function without debouncing for sequences
        function speak(text, callback) {
            if (!text || text.trim() === '') {
                console.warn('‚ö†Ô∏è Empty text, skipping');
                if (callback) callback();
                return;
            }

            text = text.replace('üîä', '').trim();

            // Only stop if NOT playing a sequence
            if (!isPlayingSequence) {
                stopAllSpeech();
            }

            setTimeout(() => {
                speakNow(text, callback);
            }, 100);
        }

        function stopAllSpeech() {
            isPlayingSequence = false;
            window.speechSynthesis.cancel();
            isSpeaking = false;
            hideAudioStatus();
            console.log('‚èπÔ∏è All speech stopped');
        }

        function speakNow(text, callback) {
            if (!('speechSynthesis' in window)) {
                alert('‚ö†Ô∏è Text-to-speech not supported.\n\nUse Chrome, Firefox, Edge, or Safari.');
                if (callback) callback();
                return;
            }

            showAudioStatus(text);
            console.log('üó£Ô∏è Speaking:', text);

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'de-DE';
            if (germanVoice) utterance.voice = germanVoice;
            utterance.rate = parseFloat(document.getElementById('speedControl').value);
            utterance.pitch = parseFloat(document.getElementById('pitchControl').value);
            utterance.volume = 1.0;

            let hasEnded = false;

            utterance.onstart = function() {
                isSpeaking = true;
                console.log('‚ñ∂Ô∏è Started:', text.substring(0, 40));
            };

            utterance.onend = function() {
                if (hasEnded) return;
                hasEnded = true;
                isSpeaking = false;
                hideAudioStatus();
                console.log('‚úÖ Ended:', text.substring(0, 40));
                if (callback) setTimeout(callback, 100);
            };

            utterance.onerror = function(event) {
                if (hasEnded) return;
                hasEnded = true;
                isSpeaking = false;
                hideAudioStatus();
                
                if (event.error !== 'interrupted' && event.error !== 'canceled') {
                    console.error('‚ùå Speech error:', event.error);
                } else {
                    console.log('‚ÑπÔ∏è Speech ' + event.error);
                }
                if (callback) callback();
            };

            currentUtterance = utterance;

            try {
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('‚ùå Speak failed:', error);
                isSpeaking = false;
                hideAudioStatus();
                if (callback) callback();
            }
        }

        function showAudioStatus(text) {
            const status = document.getElementById('audioStatus');
            const statusText = document.getElementById('audioStatusText');
            const displayText = text.length > 40 ? text.substring(0, 40) + '...' : text;
            statusText.textContent = `üîä ${displayText}`;
            status.classList.add('show');
        }

        function hideAudioStatus() {
            setTimeout(() => {
                document.getElementById('audioStatus').classList.remove('show');
            }, 300);
        }

        // ============================================
        // SPECIFIC SPEAK FUNCTIONS
        // ============================================
        function speakAdjective(word1, word2) {
            if (event) event.stopPropagation();
            console.log('üî§ Adjective pair:', word1, word2);
            isPlayingSequence = true;
            speak(word1, function() {
                setTimeout(() => {
                    speak(word2, function() {
                        isPlayingSequence = false;
                    });
                }, 800);
            });
        }

        function speakVerb(verb1, verb2) {
            if (event) event.stopPropagation();
            const cleanVerb1 = verb1.replace(/[\*\+]/g, '').trim();
            const cleanVerb2 = verb2.replace(/[\*\+]/g, '').trim();
            console.log('‚ö° Verb pair:', cleanVerb1, cleanVerb2);
            isPlayingSequence = true;
            speak(cleanVerb1, function() {
                setTimeout(() => {
                    speak(cleanVerb2, function() {
                        isPlayingSequence = false;
                    });
                }, 800);
            });
        }

        function speakQA(question, answer) {
            if (event) event.stopPropagation();
            console.log('‚ùì Q&A:', question, answer);
            isPlayingSequence = true;
            speak(question, function() {
                setTimeout(() => {
                    speak(answer, function() {
                        isPlayingSequence = false;
                    });
                }, 1200);
            });
        }

        // NEW: Noun function with plural
        function speakNounRow(article, singular, pluralFull) {
            if (event) event.stopPropagation();
            speakNounWithPlural(article, singular, pluralFull);
        }

        function speakNounWithPlural(article, singular, pluralFull) {
            console.log('üìö Noun with plural:', article, singular, '‚Üí', pluralFull);
            isPlayingSequence = true;
            
            speak(`${article} ${singular}`, function() {
                if (pluralFull !== '---' && pluralFull !== 'kein Plural') {
                    setTimeout(() => {
                        speak(pluralFull, function() {
                            isPlayingSequence = false;
                        });
                    }, 300);
                } else {
                    isPlayingSequence = false;
                }
            });
        }

        // ============================================
        // PLAY ALL IN SECTION
        // ============================================
        let playAllActive = false;
        let playAllIndex = 0;
        let playAllTexts = [];

        function playAllInSection() {
            const playBtn = document.querySelector('.play-all-btn');

            if (playAllActive) {
                playAllActive = false;
                stopAllSpeech();
                playBtn.textContent = '‚ñ∂ Play All in Section';
                console.log('‚èπÔ∏è Play all stopped');
                return;
            }

            const activeTab = document.querySelector('.tab-content.active');
            const tabId = activeTab.id;
            playAllTexts = [];

            switch(tabId) {
                case 'nouns':
                    const nounsData = parseCSV(nounsCSV);
                    nounsData.forEach(row => {
                        const [article, german, pluralNotation, pluralFull, english] = row;
                        playAllTexts.push(`${article} ${german}`);
                        if (pluralFull !== '---' && pluralFull !== 'kein Plural') {
                            playAllTexts.push(pluralFull);
                        }
                    });
                    break;

                case 'adjectives':
                    const adjCards = activeTab.querySelectorAll('.word-pair');
                    adjCards.forEach(card => {
                        const germans = card.querySelectorAll('.german');
                        germans.forEach(g => playAllTexts.push(g.textContent.trim()));
                    });
                    break;

                case 'verbs':
                    const verbCards = activeTab.querySelectorAll('.word-pair');
                    verbCards.forEach(card => {
                        const germans = card.querySelectorAll('.german');
                        germans.forEach(g => {
                            const cleanText = g.textContent.replace(/[\*\+]/g, '').trim();
                            playAllTexts.push(cleanText);
                        });
                    });
                    break;

                case 'expressions':
                    const exprs = activeTab.querySelectorAll('.expression-german');
                    exprs.forEach(expr => playAllTexts.push(expr.textContent.replace('üîä', '').trim()));
                    break;

                case 'conversations':
                    const messages = activeTab.querySelectorAll('.message-german');
                    messages.forEach(msg => playAllTexts.push(msg.textContent.replace('üîä', '').trim()));
                    break;

                case 'qa':
                    const questions = activeTab.querySelectorAll('.question');
                    questions.forEach(q => playAllTexts.push(q.textContent.replace('üîä', '').trim()));
                    break;

                case 'sentences':
                    const sentences = activeTab.querySelectorAll('.sentence-german');
                    sentences.forEach(s => playAllTexts.push(s.textContent.replace('üîä', '').trim()));
                    break;
            }

            if (playAllTexts.length === 0) {
                alert('No items to play in this section.');
                return;
            }

            console.log('üìö Playing', playAllTexts.length, 'items');
            playAllActive = true;
            isPlayingSequence = true;
            playAllIndex = 0;
            playBtn.textContent = '‚èπÔ∏è Stop Playing';

            playNextInSequence(playBtn);
        }

        function playNextInSequence(playBtn) {
            if (!playAllActive || playAllIndex >= playAllTexts.length) {
                playAllActive = false;
                isPlayingSequence = false;
                playBtn.textContent = '‚ñ∂ Play All in Section';
                hideAudioStatus();

                if (playAllIndex >= playAllTexts.length) {
                    setTimeout(() => {
                        alert('‚úÖ Finished playing all ' + playAllTexts.length + ' items!');
                    }, 500);
                }
                return;
            }

            const progress = Math.round(((playAllIndex + 1) / playAllTexts.length) * 100);
            console.log(`üîä Progress: ${playAllIndex + 1}/${playAllTexts.length} (${progress}%)`);

            const currentText = playAllTexts[playAllIndex];
            playAllIndex++;

            speak(currentText, function() {
                setTimeout(() => {
                    playNextInSequence(playBtn);
                }, 1000);
            });
        }

        // ============================================
        // TAB SWITCHING
        // ============================================
        function showTab(tabName) {
            stopAllSpeech();
            playAllActive = false;

            const playBtn = document.querySelector('.play-all-btn');
            if (playBtn) playBtn.textContent = '‚ñ∂ Play All in Section';

            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            if (event && event.target) event.target.classList.add('active');

            console.log('üìë Tab:', tabName);
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // ============================================
        // CSV PARSERS AND RENDERERS
        // ============================================
        function parseCSV(csv) {
            return csv.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => line.split(',').map(cell => cell.trim()));
        }

                function renderNouns() {
            const data = parseCSV(nounsCSV);
            const grouped = { das: [], der: [], die: [] };

            data.forEach(row => {
                const [article, german, pluralNotation, pluralFull, english] = row;
                grouped[article].push({ article, german, pluralNotation, pluralFull, english });
            });

            const articles = [
                { key: 'der', label: 'Maskulinum (der)', color: '#2196F3' },
                { key: 'das', label: 'Neutrum (das)', color: '#4CAF50' },
                { key: 'die', label: 'Femininum (die)', color: '#F44336' }
            ];

            // ============================================
            // DESKTOP TABLE VIEW
            // ============================================
            let tableHtml = '';
            articles.forEach(({ key, label, color }) => {
                if (grouped[key].length > 0) {
                    tableHtml += `<h3 style="color: ${color}; margin-top: 40px;">${label}</h3>`;
                    tableHtml += `<table class="vocab-table ${key}">
                        <thead>
                            <tr>
                                <th>Article</th>
                                <th>German</th>
                                <th>Plural</th>
                                <th>English</th>
                                <th>Audio</th>
                            </tr>
                        </thead>
                        <tbody>`;

                    grouped[key].forEach(word => {
                        const escapedSingular = word.german.replace(/'/g, "\\'");
                        const escapedPlural = word.pluralFull.replace(/'/g, "\\'");

                        tableHtml += `<tr onclick="speakNounRow('${word.article}', '${escapedSingular}', '${escapedPlural}')">
                            <td class="article ${word.article}">${word.article}</td>
                            <td class="german-word">${word.german}</td>
                            <td class="plural">${word.pluralNotation}</td>
                            <td class="english-word">${word.english}</td>
                            <td><button class="audio-btn" onclick="event.stopPropagation(); speakNounWithPlural('${word.article}', '${escapedSingular}', '${escapedPlural}')">üîä</button></td>
                        </tr>`;
                    });

                    tableHtml += `</tbody></table>`;
                }
            });

            // ============================================
            // MOBILE CARD VIEW
            // ============================================
            let mobileHtml = '<div class="mobile-noun-cards">';

            articles.forEach(({ key, label, color }) => {
                if (grouped[key].length > 0) {
                    mobileHtml += `<h3 style="color: ${color}; margin-top: 30px; margin-bottom: 15px;">${label}</h3>`;

                    grouped[key].forEach(word => {
                        const escapedSingular = word.german.replace(/'/g, "\\'");
                        const escapedPlural = word.pluralFull.replace(/'/g, "\\'");

                        mobileHtml += `
                        <div class="mobile-noun-card ${word.article}" onclick="speakNounRow('${word.article}', '${escapedSingular}', '${escapedPlural}')">
                            <div class="mobile-noun-header">
                                <div class="mobile-article-word ${word.article}">
                                    <span>${word.article}</span>
                                    <span>${word.german}</span>
                                </div>
                                <button class="mobile-audio-btn" onclick="event.stopPropagation(); speakNounWithPlural('${word.article}', '${escapedSingular}', '${escapedPlural}')">üîä</button>
                            </div>
                            <div class="mobile-noun-details">
                                <span class="mobile-label">Plural:</span>
                                <span class="mobile-plural">${word.pluralNotation}</span>
                                <span class="mobile-label">English:</span>
                                <span class="mobile-english">${word.english}</span>
                            </div>
                        </div>`;
                    });
                }
            });

            mobileHtml += '</div>';

            // Combine both views
            document.getElementById('nounsContainer').innerHTML = tableHtml + mobileHtml;
        }

        function renderAdjectives() {
            const data = parseCSV(adjectivesCSV);
            let html = '';

            data.forEach(row => {
                const [word1, english1, word2, english2] = row;
                html += `<div class="word-pair" onclick="speakAdjective('${word1}', '${word2}')">
                    <div class="card-audio-btn">üîä</div>
                    <div class="german">${word1}</div>
                    <div class="english">${english1}</div>
                    <div class="opposite-arrow">‚ü∑</div>
                    <div class="german">${word2}</div>
                    <div class="english">${english2}</div>
                </div>`;
            });

            document.getElementById('adjectivesContainer').innerHTML = html;
        }

        function renderVerbs() {
            const data = parseCSV(verbsCSV);
            let html = '';

            data.forEach(row => {
                const [type, verb1, english1, verb2, english2] = row;
                const prefix = type === 'weak' ? '*' : '+';
                const gradient = type === 'weak' 
                    ? 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
                    : 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)';
                
                html += `<div class="word-pair" style="background: ${gradient};" onclick="speakVerb('${verb1}', '${verb2}')">
                    <div class="card-audio-btn">üîä</div>
                    <div class="german">${prefix}${verb1}</div>
                    <div class="english">${english1}</div>
                    <div class="opposite-arrow">‚ü∑</div>
                    <div class="german">${prefix}${verb2}</div>
                    <div class="english">${english2}</div>
                </div>`;
            });

            document.getElementById('verbsContainer').innerHTML = html;
        }

        function renderExpressions() {
            const data = parseCSV(expressionsCSV);
            let html = '';

            data.forEach(row => {
                const [german, english] = row;
                const escapedGerman = german.replace(/'/g, "\\'");
                html += `<li class="expression-item" onclick="speak('${escapedGerman}')">
                    <div class="expression-german">${german} üîä</div>
                    <div class="expression-english">${english}</div>
                </li>`;
            });

            document.getElementById('expressionsContainer').innerHTML = html;
        }

        function renderConversations() {
            const data = parseCSV(conversationsCSV);
            const conversations = {};

            data.forEach(row => {
                const [titleSpeaker, german, english] = row;
                const [title, speaker] = titleSpeaker.split('|');
                
                if (!conversations[title]) {
                    conversations[title] = [];
                }
                conversations[title].push({ speaker, german, english });
            });

            let html = '';
            Object.keys(conversations).forEach((title, index) => {
                html += `<h3 style="color: #667eea; margin-top: ${index > 0 ? '40px' : '30px'};">Conversation ${index + 1}: ${title}</h3>`;
                html += `<div class="conversation">`;
                
                conversations[title].forEach(msg => {
                    const messageClass = msg.speaker === 'A' ? 'message-a' : 'message-b';
                    const escapedGerman = msg.german.replace(/'/g, "\\'");
                    html += `<div class="message ${messageClass}" onclick="speak('${escapedGerman}')">
                        <div class="message-german">${msg.german} üîä</div>
                        <div class="message-english">${msg.english}</div>
                    </div>`;
                });
                
                html += `</div>`;
            });

            document.getElementById('conversationsContainer').innerHTML = html;
        }

        function renderQA() {
            const data = parseCSV(qaCSV);
            let html = '';

            data.forEach(row => {
                const [question, answer] = row;
                const escapedQ = question.replace(/'/g, "\\'");
                const escapedA = answer.replace(/'/g, "\\'");
                html += `<div class="qa-card" onclick="speakQA('${escapedQ}', '${escapedA}')">
                    <div class="question">${question} üîä</div>
                    <div class="answer">${answer}</div>
                </div>`;
            });

            document.getElementById('qaContainer').innerHTML = html;
        }

        function renderSentences() {
            const data = parseCSV(sentencesCSV);
            let html = '';

            data.forEach(row => {
                const [german, english] = row;
                const escapedGerman = german.replace(/'/g, "\\'");
                html += `<div class="sentence-card" onclick="speak('${escapedGerman}')">
                    <div class="sentence-german">${german} üîä</div>
                    <div class="sentence-english">${english}</div>
                </div>`;
            });

            document.getElementById('sentencesContainer').innerHTML = html;
        }

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;

            if (e.key === 's' || e.key === 'S' || e.key === 'Escape') {
                stopAllSpeech();
                playAllActive = false;
                const playBtn = document.querySelector('.play-all-btn');
                if (playBtn) playBtn.textContent = '‚ñ∂ Play All in Section';
                console.log('‚èπÔ∏è Stopped by keyboard');
            }

            if (e.key === 'p' || e.key === 'P') {
                playAllInSection();
            }

            const tabMap = {
                '1': 'nouns',
                '2': 'adjectives',
                '3': 'verbs',
                '4': 'expressions',
                '5': 'conversations',
                '6': 'qa',
                '7': 'sentences'
            };

            if (tabMap[e.key]) {
                const buttons = document.querySelectorAll('.tab-button');
                buttons.forEach((btn, idx) => {
                    if (Object.values(tabMap)[idx] === tabMap[e.key]) {
                        btn.click();
                    }
                });
            }
        });

        // ============================================
        // CLEANUP
        // ============================================
        window.addEventListener('beforeunload', function() {
            stopAllSpeech();
        });

        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                stopAllSpeech();
                playAllActive = false;
            }
        });

        // ============================================
        // INITIALIZE
        // ============================================
        window.addEventListener('load', function() {
            console.log('üá©üá™ German Vocabulary Loaded!');
            console.log('üí° Shortcuts: S/Esc=Stop | P=Play All | 1-7=Tabs');

            renderNouns();
            renderAdjectives();
            renderVerbs();
            renderExpressions();
            renderConversations();
            renderQA();
            renderSentences();

            loadVoices();
            setTimeout(loadVoices, 100);
            setTimeout(loadVoices, 500);
            setTimeout(loadVoices, 1000);

            if (!('speechSynthesis' in window)) {
                alert('‚ö†Ô∏è Text-to-speech not supported.\n\nPlease use Chrome, Firefox, Edge, or Safari.');
            }
        });
    </script>
</body>
</html>