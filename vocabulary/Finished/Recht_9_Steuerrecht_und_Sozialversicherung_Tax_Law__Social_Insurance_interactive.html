<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Vocabulary - Interactive Audio Learning - Steuerrecht und Sozialversicherung (Tax Law & Social Insurance)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(90deg, #000000, #DD0000, #FFCE00);
            color: white;
            text-align: center;
            padding: 40px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .audio-controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .audio-controls h3 {
            color: #667eea;
            margin-bottom: 10px;
            width: 100%;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
        }

        .control-group select,
        .control-group input {
            padding: 8px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .play-all-btn {
            background: linear-gradient(135deg, #DD0000, #FFCE00);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .play-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .tab-button {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: #DD0000;
            color: white;
        }

        .tab-button.active {
            background: #DD0000;
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #DD0000;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #FFCE00;
            padding-bottom: 10px;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .vocab-table th {
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }

        /* COLOR-CODED HEADERS FOR EACH ARTICLE */
        /* der = BLUE, das = GREEN, die = RED */
        .vocab-table.der th {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .vocab-table.das th {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }

        .vocab-table.die th {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }

        .vocab-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .vocab-table tr {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* PERMANENT COLOR-CODED ROW BACKGROUNDS */
        /* der = BLUE, das = GREEN, die = RED */
        .vocab-table.der tbody tr {
            background: #E3F2FD;
        }

        .vocab-table.das tbody tr {
            background: #E8F5E9;
        }

        .vocab-table.die tbody tr {
            background: #FFEBEE;
        }

        /* DARKER ON HOVER */
        .vocab-table.der tbody tr:hover {
            background: #BBDEFB;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .vocab-table.das tbody tr:hover {
            background: #C8E6C9;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .vocab-table.die tbody tr:hover {
            background: #FFCDD2;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        .article {
            font-weight: bold;
            font-size: 1.1em;
        }

        /* COLOR-CODED ARTICLES AND WORDS */
        /* der = BLUE, das = GREEN, die = RED */
        .vocab-table.der .article,
        .vocab-table.der .german-word {
            color: #1565C0;
            font-weight: 700;
        }

        .vocab-table.das .article,
        .vocab-table.das .german-word {
            color: #2E7D32;
            font-weight: 700;
        }

        .vocab-table.die .article,
        .vocab-table.die .german-word {
            color: #C62828;
            font-weight: 700;
        }
        /* MOBILE-RESPONSIVE NOUNS TABLE */
        @media (max-width: 768px) {
            .vocab-table {
                display: none; /* Hide table on mobile */
            }

            .mobile-noun-card {
                display: block;
                background: white;
                border-left: 5px solid;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .mobile-noun-card.der {
                border-color: #2196F3;
                background: #E3F2FD;
            }

            .mobile-noun-card.das {
                border-color: #4CAF50;
                background: #E8F5E9;
            }

            .mobile-noun-card.die {
                border-color: #F44336;
                background: #FFEBEE;
            }

            .mobile-noun-card:active {
                transform: scale(0.98);
            }

            .mobile-noun-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }

            .mobile-article-word {
                font-size: 1.3em;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .mobile-article-word.der {
                color: #1565C0;
            }

            .mobile-article-word.das {
                color: #2E7D32;
            }

            .mobile-article-word.die {
                color: #C62828;
            }

            .mobile-audio-btn {
                background: #FFCE00;
                border: none;
                padding: 8px 12px;
                border-radius: 15px;
                font-size: 1.1em;
                cursor: pointer;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }

            .mobile-audio-btn:active {
                transform: scale(0.95);
            }

            .mobile-noun-details {
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 8px 12px;
                font-size: 0.95em;
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px solid rgba(0,0,0,0.1);
            }

            .mobile-label {
                font-weight: 600;
                color: #666;
            }

            .mobile-plural {
                color: #764ba2;
                font-style: italic;
                font-weight: 600;
            }

            .mobile-english {
                color: #444;
            }

            /* Show mobile cards only on mobile */
            .mobile-noun-cards {
                display: none;
            }

            @media (max-width: 768px) {
                .mobile-noun-cards {
                    display: block;
                }
            }
        }

        /* Desktop: hide mobile cards */
        @media (min-width: 769px) {
            .mobile-noun-cards {
                display: none;
            }
        }
        .german-word {
            font-size: 1.2em;
        }

        .english-word {
            color: #666;
        }

        .plural {
            color: #764ba2;
            font-style: italic;
            font-weight: 600;
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .word-pair {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            cursor: pointer;
        }

        .word-pair:hover {
            transform: scale(1.05);
        }

        .word-pair .german {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .word-pair .english {
            font-size: 1em;
            opacity: 0.9;
        }

        .opposite-arrow {
            font-size: 1.5em;
            margin: 10px 0;
        }

        .word-pair .card-audio-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .word-pair .card-audio-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .expression-list {
            list-style: none;
            padding: 0;
        }

        .expression-item {
            background: #f8f9fa;
            margin: 10px 0;
            padding: 20px;
            border-left: 5px solid #DD0000;
            border-radius: 5px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .expression-item:hover {
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: #fff;
        }

        .expression-german {
            font-size: 1.4em;
            font-weight: bold;
            color: #000;
            margin-bottom: 5px;
        }

        .expression-english {
            font-size: 1.1em;
            color: #666;
        }

        .conversation {
            margin: 20px 0;
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 80%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .message:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: translateX(5px);
        }

        .message-a {
            background: #667eea;
            color: white;
            margin-left: 0;
            border-bottom-left-radius: 5px;
        }

        .message-b {
            background: #f093fb;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message-german {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .message-english {
            font-size: 0.95em;
            opacity: 0.9;
            font-style: italic;
        }

        .qa-container {
            display: grid;
            gap: 20px;
        }

        .qa-card {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .qa-card:hover {
            border-color: #DD0000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .question {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .answer {
            font-size: 1.1em;
            color: #333;
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .qa-card:hover .answer {
            display: block;
        }

        .sentence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sentence-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sentence-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .sentence-german {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .sentence-english {
            font-size: 1em;
            opacity: 0.9;
        }

        .audio-btn {
            background: #FFCE00;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .audio-btn:hover {
            background: #DD0000;
            color: white;
            transform: scale(1.1);
        }

        .audio-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .audio-status.show {
            display: flex;
        }

        .audio-status .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
        }

        footer p {
            margin: 10px 0;
        }

        .section-icon {
            font-size: 2em;
            margin-right: 10px;
            vertical-align: middle;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            .tabs {
                flex-direction: column;
            }
            .tab-button {
                width: 100%;
            }
            .word-grid {
                grid-template-columns: 1fr;
            }
            .sentence-grid {
                grid-template-columns: 1fr;
            }
            .message {
                max-width: 90%;
            }
            .audio-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<!-- NAVIGATION -->
<div style="background: #000; padding: 15px; text-align: center;">
    <a href="../index.html" style="color: #FFCE00; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üè† Home</a>
    <a href="../index.html#levels" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üìö Levels</a>
    <a href="../index.html#categories" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üéØ Categories</a>
    <a href="../tools/progress.html" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">üìä Progress</a>
    <a href="../about.html" style="color: white; text-decoration: none; margin: 0 10px; font-size: 1.1em;">‚ÑπÔ∏è About</a>
</div>

    <!-- ============================================ -->
    <!-- EDIT SECTION 1: HEADER INFORMATION -->
    <!-- ============================================ -->
    <header>
        <h1>üá©üá™ Steuerrecht und Sozialversicherung (Tax Law & Social Insurance)</h1>
        <p id="headerTopic">Steuerrecht und Sozialversicherung (Tax Law & Social Insurance) | Interactive Audio Learning</p>
        <p style="font-size: 0.9em; margin-top: 10px;"Created by: aliattia02 | Date: 2025-11-16</p>
    </header>

    <div class="container">
        <div class="audio-controls">
            <h3>üîä Audio Settings</h3>
            <div class="control-group">
                <label for="voiceSelect">Voice:</label>
                <select id="voiceSelect">
                    <option value="">Loading voices...</option>
                </select>
            </div>
            <div class="control-group">
                <label for="speedControl">Speed:</label>
                <input type="range" id="speedControl" min="0.5" max="1.5" step="0.1" value="0.8">
                <span id="speedValue">0.8x</span>
            </div>
            <div class="control-group">
                <label for="pitchControl">Pitch:</label>
                <input type="range" id="pitchControl" min="0.5" max="2" step="0.1" value="1">
                <span id="pitchValue">1.0</span>
            </div>
            <button class="play-all-btn" onclick="playAllInSection()">‚ñ∂ Play All in Section</button>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('nouns')">üìö Nouns</button>
            <button class="tab-button" onclick="showTab('adjectives')">‚ú® Adjectives</button>
            <button class="tab-button" onclick="showTab('verbs')">‚ö° Verbs</button>
            <button class="tab-button" onclick="showTab('expressions')">üí¨ Key Expressions</button>
            <button class="tab-button" onclick="showTab('conversations')">üó£Ô∏è Conversations</button>
            <button class="tab-button" onclick="showTab('qa')">‚ùì Q&A Practice</button>
            <button class="tab-button" onclick="showTab('sentences')">üìù Quick Sentences</button>
        </div>

        <div id="nouns" class="tab-content active">
            <div class="card">
                <h2><span class="section-icon">üìö</span>Nouns - Die Nomen</h2>
                <div id="nounsContainer"></div>
            </div>
        </div>

        <div id="adjectives" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">‚ú®</span>Adjectives - Die Adjektive</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any card to hear the pronunciation!</p>
                <div id="adjectivesContainer" class="word-grid"></div>
            </div>
        </div>

        <div id="verbs" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">‚ö°</span>Verbs - Die Verben</h2>
                <p style="margin-bottom: 20px;"><strong>*</strong> = Weak Verb | <strong>+</strong> = Strong Verb</p>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any card to hear the pronunciation!</p>
                <div id="verbsContainer" class="word-grid"></div>
            </div>
        </div>

        <div id="expressions" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">üí¨</span>Key Expressions - Wichtige Ausdr√ºcke</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any expression to hear the pronunciation!</p>
                <ul id="expressionsContainer" class="expression-list"></ul>
            </div>
        </div>

        <div id="conversations" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">üó£Ô∏è</span>Mini Conversations - Kurze Gespr√§che</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any message to hear it!</p>
                <div id="conversationsContainer"></div>
            </div>
        </div>

        <div id="qa" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">‚ùì</span>Q&A Practice - Fragen und Antworten</h2>
                <p style="margin-bottom: 20px; font-style: italic; color: #666;">üí° Hover over each card to see the answer, or click to hear it!</p>
                <div id="qaContainer" class="qa-container"></div>
            </div>
        </div>

        <div id="sentences" class="tab-content">
            <div class="card">
                <h2><span class="section-icon">üìù</span>Quick Sentences - Schnelle S√§tze</h2>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">üí° Click on any sentence to hear it!</p>
                <div id="sentencesContainer" class="sentence-grid"></div>
            </div>
        </div>
    </div>

    <div class="audio-status" id="audioStatus">
        <div class="spinner"></div>
        <span id="audioStatusText">Speaking...</span>
    </div>

    <footer>
        <p><strong>German Vocabulary - Interactive Audio Learning</strong></p>
        <p>Created for German Learners | ¬© 2025 aliattia02</p>
        <p>üîß Interactive Audio Learning Platform</p>
        <p style="margin-top: 20px; font-size: 0.9em;">
            üéØ Click anywhere to hear pronunciation | üí™ Practice makes perfect!
        </p>
        <p style="margin-top: 10px; font-size: 0.8em; opacity: 0.8;">
            Last Updated: 2025-11-16
        </p>
    </footer>

    <script>

// ============================================
// TOPIC: ARZNEIMITTELRECHT (Pharmaceutical Law)
// ============================================

// ============================================
// EDIT SECTION 2: CSV DATA - NOUNS
// ============================================
const nounsCSV = `
das,Steuerrecht,-e,die Steuerrechte,tax-law
das,Sozialversicherungswesen,-,die Sozialversicherungswesen,social-insurance-system
das,Finanzamt,Finanz√§mter,die Finanz√§mter,tax-office
das,Bruttogehalt,Bruttogeh√§lter,die Bruttogeh√§lter,gross-salary
das,Nettogehalt,Nettogeh√§lter,die Nettogeh√§lter,net-salary
das,Arbeitsentgelt,-e,die Arbeitsentgelte,employment-income
das,Einkommen,-,die Einkommen,income
das,Entgelt,-e,die Entgelte,remuneration
das,Versorgungswerk,-e,die Versorgungswerke,pension-fund
das,Umlageverfahren,-,die Umlageverfahren,pay-as-you-go-system
das,Alterseink√ºnftegesetz,-e,die Alterseink√ºnftegesetze,retirement-income-act
das,Faktorverfahren,-,die Faktorverfahren,factor-method
das,Splittingverfahren,-,die Splittingverfahren,income-splitting
das,Realsplitting,-,die Realsplittings,real-splitting
das,Pauschbetr√§ge,-,die Pauschbetr√§ge,standard-deduction
das,Homeoffice,-s,die Homeoffices,home-office
das,Arbeitszimmer,-,die Arbeitszimmer,study-room
das,Arbeitsmittel,-,die Arbeitsmittel,work-equipment
das,Lastschriftverfahren,-,die Lastschriftverfahren,direct-debit
das,Mandat,-e,die Mandate,mandate
der,Hebesatz,Hebes√§tze,die Hebes√§tze,assessment-rate
der,Gewerbeertrag,Gewerbeertr√§ge,die Gewerbeertr√§ge,trade-income
der,Steuermessbetrag,Steuermessbetr√§ge,die Steuermessbetr√§ge,tax-base-amount
der,Freibetrag,Freibetr√§ge,die Freibetr√§ge,tax-allowance
der,Grundfreibetrag,Grundfreibetr√§ge,die Grundfreibetr√§ge,basic-allowance
der,Entlastungsbetrag,Entlastungsbetr√§ge,die Entlastungsbetr√§ge,relief-amount
der,Altersentlastungsbetrag,Altersentlastungsbetr√§ge,die Altersentlastungsbetr√§ge,age-relief-amount
der,Grenzsteuersatz,Grenzsteuers√§tze,die Grenzsteuers√§tze,marginal-tax-rate
der,Spitzensteuersatz,Spitzensteuers√§tze,die Spitzensteuers√§tze,top-tax-rate
der,Solidarit√§tszuschlag,Solidarit√§tszuschl√§ge,die Solidarit√§tszuschl√§ge,solidarity-surcharge
der,Vorsteuerabzug,Vorsteuerabz√ºge,die Vorsteuerabz√ºge,input-tax-deduction
der,Regelsteuersatz,Regelsteuers√§tze,die Regelsteuers√§tze,standard-tax-rate
der,Steuersatz,Steuers√§tze,die Steuers√§tze,tax-rate
der,Beitragssatz,Beitragss√§tze,die Beitragss√§tze,contribution-rate
der,Versicherungsbeitrag,Versicherungsbeitr√§ge,die Versicherungsbeitr√§ge,insurance-contribution
der,Arbeitgeberanteil,-e,die Arbeitgeberanteile,employer-contribution
der,Arbeitnehmeranteil,-e,die Arbeitnehmeranteile,employee-contribution
der,Rentenbeitrag,Rentenbeitr√§ge,die Rentenbeitr√§ge,pension-contribution
der,Pflegebeitrag,Pflegebeitr√§ge,die Pflegebeitr√§ge,care-insurance-contribution
der,Entgeltpunkt,-e,die Entgeltpunkte,earnings-point
der,Versicherungstr√§ger,-,die Versicherungstr√§ger,insurance-provider
der,Sozialversicherungsausweis,-e,die Sozialversicherungsausweise,social-insurance-card
der,Berufsgenossenschaft,-en,die Berufsgenossenschaften,employers-liability-insurance
der,Pflegegrad,-e,die Pflegegrade,care-level
der,Zusatzbeitrag,Zusatzbeitr√§ge,die Zusatzbeitr√§ge,additional-contribution
der,Minijob,-s,die Minijobs,mini-job
der,Mindestlohn,Mindestl√∂hne,die Mindestl√∂hne,minimum-wage
die,Abgabenordnung,-en,die Abgabenordnungen,tax-code
die,Einkommensteuer,-n,die Einkommensteuern,income-tax
die,Gewerbesteuer,-n,die Gewerbesteuern,trade-tax
die,Umsatzsteuer,-n,die Umsatzsteuern,value-added-tax
die,Lohnsteuer,-n,die Lohnsteuern,wage-tax
die,Vorsteuer,-n,die Vorsteuern,input-tax
die,Zahllast,-en,die Zahllasten,tax-liability
die,Vorauszahlung,-en,die Vorauszahlungen,advance-payment
die,Steuererkl√§rung,-en,die Steuererkl√§rungen,tax-return
die,Steuerpflicht,-en,die Steuerpflichten,tax-obligation
die,Bemessungsgrundlage,-n,die Bemessungsgrundlagen,assessment-base
die,Beitragsbemessungsgrenze,-n,die Beitragsbemessungsgrenzen,contribution-ceiling
die,Einkunftsart,-en,die Einkunftsarten,type-of-income
die,Betriebsausgabe,-n,die Betriebsausgaben,business-expense
die,Werbungskosten,nur P,die Werbungskosten,work-related-expenses
die,Sonderausgabe,-n,die Sonderausgaben,special-expenses
die,Entfernungspauschale,-n,die Entfernungspauschalen,commuting-allowance
die,Fortbildungskosten,nur P,die Fortbildungskosten,training-costs
die,Bewerbungskosten,nur P,die Bewerbungskosten,application-costs
die,Umzugskosten,nur P,die Umzugskosten,relocation-costs
die,Vorsorgeaufwendung,-en,die Vorsorgeaufwendungen,pension-contributions
die,Altersvorsorge,-n,die Altersvorsorgen,retirement-provision
die,Krankenversicherung,-en,die Krankenversicherungen,health-insurance
die,Pflegeversicherung,-en,die Pflegeversicherungen,care-insurance
die,Rentenversicherung,-en,die Rentenversicherungen,pension-insurance
die,Arbeitslosenversicherung,-en,die Arbeitslosenversicherungen,unemployment-insurance
die,Unfallversicherung,-en,die Unfallversicherungen,accident-insurance
die,Regelaltersgrenze,-n,die Regelaltersgrenzen,standard-retirement-age
die,Erwerbsminderung,-en,die Erwerbsminderungen,reduced-earning-capacity
die,Pflegebed√ºrftigkeit,-en,die Pflegebed√ºrftigkeiten,need-for-care
die,Wartezeit,-en,die Wartezeiten,qualifying-period
die,Familienversicherung,-en,die Familienversicherungen,family-insurance
die,Zuzahlung,-en,die Zuzahlungen,co-payment
die,Belastungsgrenze,-n,die Belastungsgrenzen,burden-limit
die,Ersatzkasse,-n,die Ersatzkassen,substitute-fund
die,Ortskrankenkasse,-n,die Ortskrankenkassen,local-sickness-fund
die,Betriebskrankenkasse,-n,die Betriebskrankenkassen,company-health-fund
die,Berufsgenossenschaft,-en,die Berufsgenossenschaften,trade-association
die,Lohnsteuerklasse,-n,die Lohnsteuerklassen,tax-class
die,Jahresarbeitsentgeltgrenze,-n,die Jahresarbeitsentgeltgrenzen,annual-income-threshold
die,Haushaltsf√ºhrung,-en,die Haushaltsf√ºhrungen,housekeeping
die,Progressionszone,-n,die Progressionszonen,progression-zone
die,Splittingtabelle,-n,die Splittingtabellen,splitting-table
die,Grundtabelle,-n,die Grundtabellen,basic-table

`.trim();

// ============================================
// EDIT SECTION 3: CSV DATA - ADJECTIVES
// ============================================
const adjectivesCSV = `
-steuerpflichtig,taxable,-steuerfrei,tax-exempt
-versicherungspflichtig,compulsory-insured,-versicherungsfrei,exempt-from-insurance
-beitragspflichtig,contribution-liable,-beitragsfrei,contribution-free
-abzugsf√§hig,deductible,-nicht-abzugsf√§hig,non-deductible
-pflichtversichert,compulsorily-insured,-freiwillig-versichert,voluntarily-insured
-sozialversicherungspflichtig,subject-to-social-insurance,-sozialversicherungsfrei,exempt-from-social-insurance
-gesetzlich,statutory,-privat,private
-progressiv,progressive,-proportional,proportional
-brutto,gross,-netto,net
-kurzfristig,short-term,-langfristig,long-term
-geringf√ºgig,marginal,-regul√§r,regular
-unbeschr√§nkt,unlimited,-beschr√§nkt,limited
-erwerbst√§tig,gainfully-employed,-erwerbslos,unemployed
-rentenversicherungspflichtig,pension-insured,-rentenversicherungsfrei,pension-exempt

`.trim();

// ============================================
// EDIT SECTION 4: CSV DATA - VERBS
// ============================================
const verbsCSV = `
*versteuern,tax,*abf√ºhren,remit
*erheben,levy,*einziehen,collect
*anrechnen,credit,*verrechnen,offset
*erstatten,refund,*zur√ºckzahlen,repay
*geltend-machen,claim,*beantragen,apply-for
*einbehalten,withhold,*abziehen,deduct
*veranlagen,assess,*festsetzen,determine
*beitragen,contribute,*einzahlen,pay-in
*versichern,insure,*absichern,secure
*befreien,exempt,*entlasten,relieve
*bezuschussen,subsidize,*f√∂rdern,support
*abrechnen,bill,*verrechnen,settle
*√ºberschreiten,exceed,*unterschreiten,fall-below
*mindern,reduce,*erh√∂hen,increase
+erwerben,acquire,+verlieren,lose
+vorziehen,bring-forward,+vortragen,carry-forward
+unterliegen,be-subject-to,+entfallen,lapse
+entstehen,arise,+erl√∂schen,expire
+gelten,apply,+bestehen,exist
+beitreten,join,+austreten,leave

`.trim();

// ============================================
// EDIT SECTION 5: CSV DATA - EXPRESSIONS
// ============================================
const expressionsCSV = `
Die Steuererkl√§rung ist abzugeben.,The tax return must be filed.
Der Freibetrag wird gew√§hrt.,The allowance is granted.
Die Beitr√§ge werden eingezogen.,Contributions are collected.
Das zu versteuernde Einkommen betr√§gt.,Taxable income amounts to.
Die Zuzahlung ist zu leisten.,The co-payment must be made.
Die Belastungsgrenze ist erreicht.,The burden limit is reached.
Der Arbeitgeber f√ºhrt die Lohnsteuer ab.,The employer remits wage tax.
Die Vorsteuer wird abgezogen.,Input tax is deducted.
Es besteht Versicherungspflicht.,There is compulsory insurance.
Die Wartezeit ist erf√ºllt.,The qualifying period is met.
Der Beitragssatz betr√§gt.,The contribution rate is.
Die Rentenversicherung wird bezahlt.,Pension insurance is paid.
Die Steuer wird vom Gehalt einbehalten.,Tax is withheld from salary.
Der Gewerbeertrag wird ermittelt.,Trade income is determined.
Die Krankenversicherung √ºbernimmt die Kosten.,Health insurance covers the costs.

`.trim();

// ============================================
// EDIT SECTION 6: CSV DATA - CONVERSATIONS
// ============================================
const conversationsCSV = `
Steuererkl√§rung|A,M√ºssen Sie eine Steuererkl√§rung abgeben?,Do you have to file a tax return?
Steuererkl√§rung|B,Ja als Apotheker bin ich dazu verpflichtet.,Yes as a pharmacist I am obliged to.
Steuererkl√§rung|A,Welche Werbungskosten k√∂nnen Sie geltend machen?,What work expenses can you claim?
Steuererkl√§rung|B,Ich habe Fortbildungskosten und Fahrtkosten.,I have training costs and travel expenses.
Steuererkl√§rung|A,Haben Sie Belege daf√ºr?,Do you have receipts for that?
Steuererkl√§rung|B,Ja alle Belege sind vorhanden.,Yes all receipts are available.
Sozialversicherung|A,Sind Sie sozialversicherungspflichtig besch√§ftigt?,Are you employed subject to social insurance?
Sozialversicherung|B,Ja ich bin angestellter Apotheker.,Yes I am an employed pharmacist.
Sozialversicherung|A,Welche Beitr√§ge werden abgezogen?,Which contributions are deducted?
Sozialversicherung|B,Kranken Pflege Renten und Arbeitslosenversicherung.,Health care pension and unemployment insurance.
Sozialversicherung|A,Zahlt der Arbeitgeber die H√§lfte?,Does the employer pay half?
Sozialversicherung|B,Ja au√üer bei der Pflegeversicherung.,Yes except for care insurance.
Lohnabrechnung|A,Verstehen Sie Ihre Lohnabrechnung?,Do you understand your payslip?
Lohnabrechnung|B,Nicht ganz wo finde ich die Lohnsteuer?,Not quite where do I find wage tax?
Lohnabrechnung|A,Die Lohnsteuer steht unter den Abz√ºgen.,Wage tax is under deductions.
Lohnabrechnung|B,Und die Sozialversicherungsbeitr√§ge auch?,And social insurance contributions too?
Lohnabrechnung|A,Ja beides wird vom Bruttogehalt abgezogen.,Yes both are deducted from gross salary.
Lohnabrechnung|B,Dann ergibt sich das Nettogehalt.,Then the net salary results.

`.trim();

// ============================================
// EDIT SECTION 7: CSV DATA - Q&A
// ============================================
const qaCSV = `
Was ist die Gewerbesteuer?,Die Gewerbesteuer besteuert den Ertrag eines Gewerbebetriebs. (Trade tax taxes the income of a business.)
Wer zahlt Einkommensteuer?,Nat√ºrliche Personen mit Wohnsitz im Inland. (Natural persons with residence in Germany.)
Was ist der Grundfreibetrag?,Der Grundfreibetrag ist steuerfrei im Jahr 2026 12384 Euro. (Basic allowance is tax-free in 2026 12384 euros.)
Was bedeutet Splittingtarif?,Splittingtarif gilt f√ºr verheiratete Steuerpflichtige. (Splitting tariff applies to married taxpayers.)
Was ist Umsatzsteuer?,Umsatzsteuer ist eine Steuer auf Lieferungen und Leistungen. (VAT is tax on supplies and services.)
Wie hoch ist die Regelumsatzsteuer?,Die Regelumsatzsteuer betr√§gt 19 Prozent. (Standard VAT rate is 19 percent.)
Was sind Werbungskosten?,Werbungskosten dienen dem Erwerb von Einnahmen. (Work expenses serve to acquire income.)
Was ist die Entfernungspauschale?,Die Entfernungspauschale betr√§gt 0,38 Euro pro Kilometer. (Commuting allowance is 0.38 euros per kilometer.)
Was sind Sonderausgaben?,Sonderausgaben sind weder Betriebsausgaben noch Werbungskosten. (Special expenses are neither business expenses nor work expenses.)
Welche Sozialversicherungen gibt es?,Kranken Pflege Renten Arbeitslosen und Unfallversicherung. (Health care pension unemployment and accident insurance.)
Was ist die Beitragsbemessungsgrenze?,Die Grenze bis zu der Beitr√§ge berechnet werden. (The limit up to which contributions are calculated.)
Wer zahlt die Unfallversicherung?,Der Arbeitgeber zahlt die Unfallversicherung allein. (The employer pays accident insurance alone.)
Was ist ein Minijob?,Ein Minijob ist eine geringf√ºgige Besch√§ftigung bis 538 Euro. (A mini-job is marginal employment up to 538 euros.)
Was bedeutet Versicherungspflicht?,Versicherungspflicht bedeutet man muss versichert sein. (Compulsory insurance means one must be insured.)
Was ist die Regelaltersgrenze?,Die Regelaltersgrenze liegt bei 67 Jahren. (Standard retirement age is 67 years.)
Wann besteht Familienversicherung?,Bei gesetzlicher Krankenversicherung f√ºr Angeh√∂rige. (With statutory health insurance for dependents.)
Was ist ein Pflegegrad?,Ein Pflegegrad bestimmt den Umfang der Pflegeleistungen. (A care level determines the scope of care benefits.)
Was sind Zuzahlungen?,Zuzahlungen sind Eigenbeteiligungen der Versicherten. (Co-payments are patient contributions.)
Was ist die Belastungsgrenze?,Die Grenze bei der Zuzahlungsbefreiung eintritt. (The limit where co-payment exemption occurs.)
Welche Lohnsteuerklassen gibt es?,Es gibt sechs Lohnsteuerklassen. (There are six tax classes.)

`.trim();

// ============================================
// EDIT SECTION 8: CSV DATA - SENTENCES
// ============================================
const sentencesCSV = `
Steuern sind Geldleistungen ohne Gegenleistung.,Taxes are monetary payments without consideration.
Die Einkommensteuer wird auf das Einkommen erhoben.,Income tax is levied on income.
Die Gewerbesteuer wird von der Gemeinde erhoben.,Trade tax is levied by the municipality.
Der Hebesatz wird von der Gemeinde festgelegt.,The assessment rate is set by the municipality.
Die Umsatzsteuer wird prozentual vom Entgelt berechnet.,VAT is calculated as percentage of remuneration.
Die Vorsteuer kann abgezogen werden.,Input tax can be deducted.
Das zu versteuernde Einkommen ist die Bemessungsgrundlage.,Taxable income is the assessment base.
Die Lohnsteuer wird vom Arbeitgeber einbehalten.,Wage tax is withheld by the employer.
Der Solidarit√§tszuschlag betr√§gt 5,5 Prozent.,The solidarity surcharge is 5.5 percent.
Die Entfernungspauschale betr√§gt 0,38 Euro pro Kilometer.,The commuting allowance is 0.38 euros per kilometer.
Werbungskosten mindern die steuerpflichtigen Eink√ºnfte.,Work expenses reduce taxable income.
Sonderausgaben sind von den Eink√ºnften abziehbar.,Special expenses are deductible from income.
Die Sozialversicherung hat f√ºnf Zweige.,Social insurance has five branches.
Die Beitr√§ge richten sich nach dem Bruttogehalt.,Contributions are based on gross salary.
Die Krankenversicherung √ºbernimmt die Behandlungskosten.,Health insurance covers treatment costs.
Die Rentenversicherung sichert das Alter ab.,Pension insurance secures old age.
Die Pflegeversicherung zahlt bei Pflegebed√ºrftigkeit.,Care insurance pays for need of care.
Die Arbeitslosenversicherung zahlt Arbeitslosengeld.,Unemployment insurance pays unemployment benefit.
Die Unfallversicherung zahlt der Arbeitgeber allein.,The employer pays accident insurance alone.
Die Beitragsbemessungsgrenze begrenzt die Beitr√§ge.,The contribution ceiling limits contributions.
Die Regelaltersgrenze liegt bei 67 Jahren.,The standard retirement age is 67 years.
Versicherte zahlen Zuzahlungen zu Arzneimitteln.,Insured persons pay co-payments for medicines.
Die Belastungsgrenze betr√§gt 2 Prozent des Einkommens.,The burden limit is 2 percent of income.
Chronisch Kranke zahlen nur 1 Prozent.,Chronically ill pay only 1 percent.
Ein Minijob ist sozialversicherungsfrei f√ºr den Arbeitnehmer.,A mini-job is exempt from social insurance for employee.
Der Arbeitgeber zahlt pauschale Beitr√§ge beim Minijob.,The employer pays flat-rate contributions for mini-job.
Die Apothekerversorgung ersetzt die gesetzliche Rentenversicherung.,Pharmacist pension fund replaces statutory pension insurance.
Der Befreiungsantrag muss innerhalb drei Monaten gestellt werden.,The exemption application must be filed within three months.
Die Familienversicherung ist beitragsfrei.,Family insurance is contribution-free.
Die Lohnsteuerklasse bestimmt die Lohnsteuer.,The tax class determines wage tax.

`.trim();

        // ============================================
        // SPEECH SYNTHESIS - FIXED FOR PLURAL ISSUE
        // ============================================
        let germanVoice = null;
        let currentUtterance = null;
        let isSpeaking = false;
        let isPlayingSequence = false; // NEW: Track if playing a sequence

        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';

            const germanVoices = voices.filter(voice => voice.lang.startsWith('de'));

            if (germanVoices.length === 0) {
                voiceSelect.innerHTML = '<option value="">No German voice found - Using default</option>';
                germanVoice = voices.find(v => v.lang.includes('en')) || voices[0];
            } else {
                germanVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    voiceSelect.appendChild(option);
                    if (index === 0) germanVoice = voice;
                });
            }
            console.log('‚úÖ Voice loaded:', germanVoice ? germanVoice.name : 'None');
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        loadVoices();
        setTimeout(loadVoices, 100);
        setTimeout(loadVoices, 500);

        document.getElementById('voiceSelect').addEventListener('change', function(e) {
            stopAllSpeech();
            const voices = window.speechSynthesis.getVoices();
            const germanVoices = voices.filter(voice => voice.lang.startsWith('de'));
            germanVoice = germanVoices[e.target.value] || voices[0];
            console.log('üîÑ Voice changed to:', germanVoice ? germanVoice.name : 'default');
        });

        document.getElementById('speedControl').addEventListener('input', function(e) {
            document.getElementById('speedValue').textContent = e.target.value + 'x';
        });

        document.getElementById('pitchControl').addEventListener('input', function(e) {
            document.getElementById('pitchValue').textContent = e.target.value;
        });

        // IMPROVED: Simple speak function without debouncing for sequences
        function speak(text, callback) {
            if (!text || text.trim() === '') {
                console.warn('‚ö†Ô∏è Empty text, skipping');
                if (callback) callback();
                return;
            }

            text = text.replace('üîä', '').trim();

            // Only stop if NOT playing a sequence
            if (!isPlayingSequence) {
                stopAllSpeech();
            }

            setTimeout(() => {
                speakNow(text, callback);
            }, 100);
        }

        function stopAllSpeech() {
            isPlayingSequence = false;
            window.speechSynthesis.cancel();
            isSpeaking = false;
            hideAudioStatus();
            console.log('‚èπÔ∏è All speech stopped');
        }

        function speakNow(text, callback) {
            if (!('speechSynthesis' in window)) {
                alert('‚ö†Ô∏è Text-to-speech not supported.\n\nUse Chrome, Firefox, Edge, or Safari.');
                if (callback) callback();
                return;
            }

            showAudioStatus(text);
            console.log('üó£Ô∏è Speaking:', text);

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'de-DE';
            if (germanVoice) utterance.voice = germanVoice;
            utterance.rate = parseFloat(document.getElementById('speedControl').value);
            utterance.pitch = parseFloat(document.getElementById('pitchControl').value);
            utterance.volume = 1.0;

            let hasEnded = false;

            utterance.onstart = function() {
                isSpeaking = true;
                console.log('‚ñ∂Ô∏è Started:', text.substring(0, 40));
            };

            utterance.onend = function() {
                if (hasEnded) return;
                hasEnded = true;
                isSpeaking = false;
                hideAudioStatus();
                console.log('‚úÖ Ended:', text.substring(0, 40));
                if (callback) setTimeout(callback, 100);
            };

            utterance.onerror = function(event) {
                if (hasEnded) return;
                hasEnded = true;
                isSpeaking = false;
                hideAudioStatus();
                
                if (event.error !== 'interrupted' && event.error !== 'canceled') {
                    console.error('‚ùå Speech error:', event.error);
                } else {
                    console.log('‚ÑπÔ∏è Speech ' + event.error);
                }
                if (callback) callback();
            };

            currentUtterance = utterance;

            try {
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('‚ùå Speak failed:', error);
                isSpeaking = false;
                hideAudioStatus();
                if (callback) callback();
            }
        }

        function showAudioStatus(text) {
            const status = document.getElementById('audioStatus');
            const statusText = document.getElementById('audioStatusText');
            const displayText = text.length > 40 ? text.substring(0, 40) + '...' : text;
            statusText.textContent = `üîä ${displayText}`;
            status.classList.add('show');
        }

        function hideAudioStatus() {
            setTimeout(() => {
                document.getElementById('audioStatus').classList.remove('show');
            }, 300);
        }

        // ============================================
        // SPECIFIC SPEAK FUNCTIONS
        // ============================================
        function speakAdjective(word1, word2) {
            if (event) event.stopPropagation();
            console.log('üî§ Adjective pair:', word1, word2);
            isPlayingSequence = true;
            speak(word1, function() {
                setTimeout(() => {
                    speak(word2, function() {
                        isPlayingSequence = false;
                    });
                }, 800);
            });
        }

        function speakVerb(verb1, verb2) {
            if (event) event.stopPropagation();
            const cleanVerb1 = verb1.replace(/[\*\+]/g, '').trim();
            const cleanVerb2 = verb2.replace(/[\*\+]/g, '').trim();
            console.log('‚ö° Verb pair:', cleanVerb1, cleanVerb2);
            isPlayingSequence = true;
            speak(cleanVerb1, function() {
                setTimeout(() => {
                    speak(cleanVerb2, function() {
                        isPlayingSequence = false;
                    });
                }, 800);
            });
        }

        function speakQA(question, answer) {
            if (event) event.stopPropagation();
            console.log('‚ùì Q&A:', question, answer);
            isPlayingSequence = true;
            speak(question, function() {
                setTimeout(() => {
                    speak(answer, function() {
                        isPlayingSequence = false;
                    });
                }, 1200);
            });
        }

        // NEW: Noun function with plural
        function speakNounRow(article, singular, pluralFull) {
            if (event) event.stopPropagation();
            speakNounWithPlural(article, singular, pluralFull);
        }

        function speakNounWithPlural(article, singular, pluralFull) {
            console.log('üìö Noun with plural:', article, singular, '‚Üí', pluralFull);
            isPlayingSequence = true;
            
            speak(`${article} ${singular}`, function() {
                if (pluralFull !== '---' && pluralFull !== 'kein Plural') {
                    setTimeout(() => {
                        speak(pluralFull, function() {
                            isPlayingSequence = false;
                        });
                    }, 300);
                } else {
                    isPlayingSequence = false;
                }
            });
        }

        // ============================================
        // PLAY ALL IN SECTION
        // ============================================
        let playAllActive = false;
        let playAllIndex = 0;
        let playAllTexts = [];

        function playAllInSection() {
            const playBtn = document.querySelector('.play-all-btn');

            if (playAllActive) {
                playAllActive = false;
                stopAllSpeech();
                playBtn.textContent = '‚ñ∂ Play All in Section';
                console.log('‚èπÔ∏è Play all stopped');
                return;
            }

            const activeTab = document.querySelector('.tab-content.active');
            const tabId = activeTab.id;
            playAllTexts = [];

            switch(tabId) {
                case 'nouns':
                    const nounsData = parseCSV(nounsCSV);
                    nounsData.forEach(row => {
                        const [article, german, pluralNotation, pluralFull, english] = row;
                        playAllTexts.push(`${article} ${german}`);
                        if (pluralFull !== '---' && pluralFull !== 'kein Plural') {
                            playAllTexts.push(pluralFull);
                        }
                    });
                    break;

                case 'adjectives':
                    const adjCards = activeTab.querySelectorAll('.word-pair');
                    adjCards.forEach(card => {
                        const germans = card.querySelectorAll('.german');
                        germans.forEach(g => playAllTexts.push(g.textContent.trim()));
                    });
                    break;

                case 'verbs':
                    const verbCards = activeTab.querySelectorAll('.word-pair');
                    verbCards.forEach(card => {
                        const germans = card.querySelectorAll('.german');
                        germans.forEach(g => {
                            const cleanText = g.textContent.replace(/[\*\+]/g, '').trim();
                            playAllTexts.push(cleanText);
                        });
                    });
                    break;

                case 'expressions':
                    const exprs = activeTab.querySelectorAll('.expression-german');
                    exprs.forEach(expr => playAllTexts.push(expr.textContent.replace('üîä', '').trim()));
                    break;

                case 'conversations':
                    const messages = activeTab.querySelectorAll('.message-german');
                    messages.forEach(msg => playAllTexts.push(msg.textContent.replace('üîä', '').trim()));
                    break;

                case 'qa':
                    const questions = activeTab.querySelectorAll('.question');
                    questions.forEach(q => playAllTexts.push(q.textContent.replace('üîä', '').trim()));
                    break;

                case 'sentences':
                    const sentences = activeTab.querySelectorAll('.sentence-german');
                    sentences.forEach(s => playAllTexts.push(s.textContent.replace('üîä', '').trim()));
                    break;
            }

            if (playAllTexts.length === 0) {
                alert('No items to play in this section.');
                return;
            }

            console.log('üìö Playing', playAllTexts.length, 'items');
            playAllActive = true;
            isPlayingSequence = true;
            playAllIndex = 0;
            playBtn.textContent = '‚èπÔ∏è Stop Playing';

            playNextInSequence(playBtn);
        }

        function playNextInSequence(playBtn) {
            if (!playAllActive || playAllIndex >= playAllTexts.length) {
                playAllActive = false;
                isPlayingSequence = false;
                playBtn.textContent = '‚ñ∂ Play All in Section';
                hideAudioStatus();

                if (playAllIndex >= playAllTexts.length) {
                    setTimeout(() => {
                        alert('‚úÖ Finished playing all ' + playAllTexts.length + ' items!');
                    }, 500);
                }
                return;
            }

            const progress = Math.round(((playAllIndex + 1) / playAllTexts.length) * 100);
            console.log(`üîä Progress: ${playAllIndex + 1}/${playAllTexts.length} (${progress}%)`);

            const currentText = playAllTexts[playAllIndex];
            playAllIndex++;

            speak(currentText, function() {
                setTimeout(() => {
                    playNextInSequence(playBtn);
                }, 1000);
            });
        }

        // ============================================
        // TAB SWITCHING
        // ============================================
        function showTab(tabName) {
            stopAllSpeech();
            playAllActive = false;

            const playBtn = document.querySelector('.play-all-btn');
            if (playBtn) playBtn.textContent = '‚ñ∂ Play All in Section';

            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            if (event && event.target) event.target.classList.add('active');

            console.log('üìë Tab:', tabName);
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // ============================================
        // CSV PARSERS AND RENDERERS
        // ============================================
        function parseCSV(csv) {
            return csv.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => line.split(',').map(cell => cell.trim()));
        }

                function renderNouns() {
            const data = parseCSV(nounsCSV);
            const grouped = { das: [], der: [], die: [] };

            data.forEach(row => {
                const [article, german, pluralNotation, pluralFull, english] = row;
                grouped[article].push({ article, german, pluralNotation, pluralFull, english });
            });

            const articles = [
                { key: 'der', label: 'Maskulinum (der)', color: '#2196F3' },
                { key: 'das', label: 'Neutrum (das)', color: '#4CAF50' },
                { key: 'die', label: 'Femininum (die)', color: '#F44336' }
            ];

            // ============================================
            // DESKTOP TABLE VIEW
            // ============================================
            let tableHtml = '';
            articles.forEach(({ key, label, color }) => {
                if (grouped[key].length > 0) {
                    tableHtml += `<h3 style="color: ${color}; margin-top: 40px;">${label}</h3>`;
                    tableHtml += `<table class="vocab-table ${key}">
                        <thead>
                            <tr>
                                <th>Article</th>
                                <th>German</th>
                                <th>Plural</th>
                                <th>English</th>
                                <th>Audio</th>
                            </tr>
                        </thead>
                        <tbody>`;

                    grouped[key].forEach(word => {
                        const escapedSingular = word.german.replace(/'/g, "\\'");
                        const escapedPlural = word.pluralFull.replace(/'/g, "\\'");

                        tableHtml += `<tr onclick="speakNounRow('${word.article}', '${escapedSingular}', '${escapedPlural}')">
                            <td class="article ${word.article}">${word.article}</td>
                            <td class="german-word">${word.german}</td>
                            <td class="plural">${word.pluralNotation}</td>
                            <td class="english-word">${word.english}</td>
                            <td><button class="audio-btn" onclick="event.stopPropagation(); speakNounWithPlural('${word.article}', '${escapedSingular}', '${escapedPlural}')">üîä</button></td>
                        </tr>`;
                    });

                    tableHtml += `</tbody></table>`;
                }
            });

            // ============================================
            // MOBILE CARD VIEW
            // ============================================
            let mobileHtml = '<div class="mobile-noun-cards">';

            articles.forEach(({ key, label, color }) => {
                if (grouped[key].length > 0) {
                    mobileHtml += `<h3 style="color: ${color}; margin-top: 30px; margin-bottom: 15px;">${label}</h3>`;

                    grouped[key].forEach(word => {
                        const escapedSingular = word.german.replace(/'/g, "\\'");
                        const escapedPlural = word.pluralFull.replace(/'/g, "\\'");

                        mobileHtml += `
                        <div class="mobile-noun-card ${word.article}" onclick="speakNounRow('${word.article}', '${escapedSingular}', '${escapedPlural}')">
                            <div class="mobile-noun-header">
                                <div class="mobile-article-word ${word.article}">
                                    <span>${word.article}</span>
                                    <span>${word.german}</span>
                                </div>
                                <button class="mobile-audio-btn" onclick="event.stopPropagation(); speakNounWithPlural('${word.article}', '${escapedSingular}', '${escapedPlural}')">üîä</button>
                            </div>
                            <div class="mobile-noun-details">
                                <span class="mobile-label">Plural:</span>
                                <span class="mobile-plural">${word.pluralNotation}</span>
                                <span class="mobile-label">English:</span>
                                <span class="mobile-english">${word.english}</span>
                            </div>
                        </div>`;
                    });
                }
            });

            mobileHtml += '</div>';

            // Combine both views
            document.getElementById('nounsContainer').innerHTML = tableHtml + mobileHtml;
        }

        function renderAdjectives() {
            const data = parseCSV(adjectivesCSV);
            let html = '';

            data.forEach(row => {
                const [word1, english1, word2, english2] = row;
                html += `<div class="word-pair" onclick="speakAdjective('${word1}', '${word2}')">
                    <div class="card-audio-btn">üîä</div>
                    <div class="german">${word1}</div>
                    <div class="english">${english1}</div>
                    <div class="opposite-arrow">‚ü∑</div>
                    <div class="german">${word2}</div>
                    <div class="english">${english2}</div>
                </div>`;
            });

            document.getElementById('adjectivesContainer').innerHTML = html;
        }

        function renderVerbs() {
            const data = parseCSV(verbsCSV);
            let html = '';

            data.forEach(row => {
                const [type, verb1, english1, verb2, english2] = row;
                const prefix = type === 'weak' ? '*' : '+';
                const gradient = type === 'weak' 
                    ? 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
                    : 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)';
                
                html += `<div class="word-pair" style="background: ${gradient};" onclick="speakVerb('${verb1}', '${verb2}')">
                    <div class="card-audio-btn">üîä</div>
                    <div class="german">${prefix}${verb1}</div>
                    <div class="english">${english1}</div>
                    <div class="opposite-arrow">‚ü∑</div>
                    <div class="german">${prefix}${verb2}</div>
                    <div class="english">${english2}</div>
                </div>`;
            });

            document.getElementById('verbsContainer').innerHTML = html;
        }

        function renderExpressions() {
            const data = parseCSV(expressionsCSV);
            let html = '';

            data.forEach(row => {
                const [german, english] = row;
                const escapedGerman = german.replace(/'/g, "\\'");
                html += `<li class="expression-item" onclick="speak('${escapedGerman}')">
                    <div class="expression-german">${german} üîä</div>
                    <div class="expression-english">${english}</div>
                </li>`;
            });

            document.getElementById('expressionsContainer').innerHTML = html;
        }

        function renderConversations() {
            const data = parseCSV(conversationsCSV);
            const conversations = {};

            data.forEach(row => {
                const [titleSpeaker, german, english] = row;
                const [title, speaker] = titleSpeaker.split('|');
                
                if (!conversations[title]) {
                    conversations[title] = [];
                }
                conversations[title].push({ speaker, german, english });
            });

            let html = '';
            Object.keys(conversations).forEach((title, index) => {
                html += `<h3 style="color: #667eea; margin-top: ${index > 0 ? '40px' : '30px'};">Conversation ${index + 1}: ${title}</h3>`;
                html += `<div class="conversation">`;
                
                conversations[title].forEach(msg => {
                    const messageClass = msg.speaker === 'A' ? 'message-a' : 'message-b';
                    const escapedGerman = msg.german.replace(/'/g, "\\'");
                    html += `<div class="message ${messageClass}" onclick="speak('${escapedGerman}')">
                        <div class="message-german">${msg.german} üîä</div>
                        <div class="message-english">${msg.english}</div>
                    </div>`;
                });
                
                html += `</div>`;
            });

            document.getElementById('conversationsContainer').innerHTML = html;
        }

        function renderQA() {
            const data = parseCSV(qaCSV);
            let html = '';

            data.forEach(row => {
                const [question, answer] = row;
                const escapedQ = question.replace(/'/g, "\\'");
                const escapedA = answer.replace(/'/g, "\\'");
                html += `<div class="qa-card" onclick="speakQA('${escapedQ}', '${escapedA}')">
                    <div class="question">${question} üîä</div>
                    <div class="answer">${answer}</div>
                </div>`;
            });

            document.getElementById('qaContainer').innerHTML = html;
        }

        function renderSentences() {
            const data = parseCSV(sentencesCSV);
            let html = '';

            data.forEach(row => {
                const [german, english] = row;
                const escapedGerman = german.replace(/'/g, "\\'");
                html += `<div class="sentence-card" onclick="speak('${escapedGerman}')">
                    <div class="sentence-german">${german} üîä</div>
                    <div class="sentence-english">${english}</div>
                </div>`;
            });

            document.getElementById('sentencesContainer').innerHTML = html;
        }

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;

            if (e.key === 's' || e.key === 'S' || e.key === 'Escape') {
                stopAllSpeech();
                playAllActive = false;
                const playBtn = document.querySelector('.play-all-btn');
                if (playBtn) playBtn.textContent = '‚ñ∂ Play All in Section';
                console.log('‚èπÔ∏è Stopped by keyboard');
            }

            if (e.key === 'p' || e.key === 'P') {
                playAllInSection();
            }

            const tabMap = {
                '1': 'nouns',
                '2': 'adjectives',
                '3': 'verbs',
                '4': 'expressions',
                '5': 'conversations',
                '6': 'qa',
                '7': 'sentences'
            };

            if (tabMap[e.key]) {
                const buttons = document.querySelectorAll('.tab-button');
                buttons.forEach((btn, idx) => {
                    if (Object.values(tabMap)[idx] === tabMap[e.key]) {
                        btn.click();
                    }
                });
            }
        });

        // ============================================
        // CLEANUP
        // ============================================
        window.addEventListener('beforeunload', function() {
            stopAllSpeech();
        });

        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                stopAllSpeech();
                playAllActive = false;
            }
        });

        // ============================================
        // INITIALIZE
        // ============================================
        window.addEventListener('load', function() {
            console.log('üá©üá™ German Vocabulary Loaded!');
            console.log('üí° Shortcuts: S/Esc=Stop | P=Play All | 1-7=Tabs');

            renderNouns();
            renderAdjectives();
            renderVerbs();
            renderExpressions();
            renderConversations();
            renderQA();
            renderSentences();

            loadVoices();
            setTimeout(loadVoices, 100);
            setTimeout(loadVoices, 500);
            setTimeout(loadVoices, 1000);

            if (!('speechSynthesis' in window)) {
                alert('‚ö†Ô∏è Text-to-speech not supported.\n\nPlease use Chrome, Firefox, Edge, or Safari.');
            }
        });
    </script>
</body>
</html>